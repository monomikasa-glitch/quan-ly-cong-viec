<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XÃ ĐỨC LẬP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .protected-content { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #a8a29e; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #78716c; }
        .modal-backdrop, .loader-backdrop { transition: opacity 0.3s ease; }
        .loader { border-top-color: #3b82f6; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .document-row:not(.summary-row):hover { background-color: #f1f5f9; }
        .summary-content { transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out; max-height: 0; overflow: hidden; }
        .summary-content.open { max-height: 2000px; } /* Increased max-height */
        .details-btn svg { transition: transform 0.3s ease; }
        .details-btn.open svg { transform: rotate(90deg); }
        .sortable-header { cursor: pointer; }
        .hidden { display: none; }
        #doc-modal .modal-content-wrapper, #notes-modal .modal-content-wrapper, #export-modal .modal-content-wrapper { max-height: 90vh; display: flex; flex-direction: column; }
        #doc-modal .modal-body, #notes-modal .modal-body { overflow-y: auto; }
        .kpi-card { 
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; 
            cursor: pointer;
        }
        .kpi-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); 
        }
        .week-header {
            background-color: #e2e8f0;
            color: #2d3748;
            font-weight: 600;
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="login-screen" class="flex items-center justify-center min-h-screen bg-gray-100">
        <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-lg">
            <div class="text-center">
                <h1 class="text-2xl font-bold text-gray-800">HỆ THỐNG KPI & AI</h1>
                <p class="text-gray-600">UBND XÃ ĐỨC LẬP</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="text-sm font-bold text-gray-600 block">Tên đăng nhập</label>
                    <input type="text" id="username" name="username" class="w-full p-3 mt-1 text-gray-800 bg-gray-100 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required autocomplete="username">
                </div>
                <div>
                    <label for="password" class="text-sm font-bold text-gray-600 block">Mật khẩu</label>
                    <input type="password" id="password" name="password" class="w-full p-3 mt-1 text-gray-800 bg-gray-100 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required autocomplete="current-password">
                </div>
                <p id="login-error" class="text-sm text-red-500 text-center hidden">Tên đăng nhập hoặc mật khẩu không đúng.</p>
                <div>
                    <button type="submit" class="w-full py-3 font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition duration-300">Đăng nhập</button>
                </div>
            </form>
        </div>
    </div>

    <div id="app-screen" class="hidden">
        <div class="container mx-auto p-4 sm:p-6 lg:p-8">
            <header class="text-center mb-8 flex justify-between items-center">
                <div></div> <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 uppercase">HỆ THỐNG KPI & AI</h1>
                    <p class="text-gray-600 text-lg mt-2 font-semibold">UBND XÃ ĐỨC LẬP</p>
                </div>
                <button id="logout-btn" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition duration-300 flex items-center justify-center shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V5h10a1 1 0 100-2H3zm12.293 4.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L16.586 13H9a1 1 0 110-2h7.586l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    Đăng xuất
                </button>
            </header>

            <div id="dashboard" class="mb-8">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Bảng điều khiển Tổng quan</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div id="card-total" class="kpi-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500" title="Nhấn để xem Tất cả công việc">
                        <h3 class="text-sm font-medium text-gray-500">Tổng số Công việc</h3>
                        <p id="kpi-total" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                    </div>
                    <div id="card-completed" class="kpi-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500" title="Nhấn để xem công việc Đã Hoàn thành">
                        <h3 class="text-sm font-medium text-gray-500">Đã Hoàn thành</h3>
                        <p id="kpi-completed" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                    </div>
                    <div id="card-pending" class="kpi-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-yellow-500" title="Nhấn để xem công việc Đang Xử lý">
                        <h3 class="text-sm font-medium text-gray-500">Đang Xử lý</h3>
                        <p id="kpi-pending" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                    </div>
                    <div id="card-overdue" class="kpi-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500" title="Nhấn để xem công việc Bị Trễ hạn">
                        <h3 class="text-sm font-medium text-gray-500">Bị Trễ hạn</h3>
                        <p id="kpi-overdue" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 sm:space-x-4">
                        <h2 class="text-xl font-semibold text-gray-700">Danh sách Công việc</h2>
<div id="admin-controls" class="flex flex-col sm:flex-row w-full sm:w-auto space-y-2 sm:space-y-0 sm:space-x-3">
    <button id="add-doc-manual-btn" class="w-full sm:w-auto border border-gray-500 text-gray-600 font-semibold py-2.5 px-5 rounded-lg hover:bg-gray-600 hover:text-white transition duration-300 flex items-center justify-center shadow-sm hover:shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path></svg>
        Thêm thủ công
    </button>
    <button id="add-text-ai-btn" class="w-full sm:w-auto border border-purple-600 text-purple-700 font-semibold py-2.5 px-5 rounded-lg hover:bg-purple-600 hover:text-white transition duration-300 flex items-center justify-center shadow-sm hover:shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2h4v4a2 2 0 002 2h4a2 2 0 002-2v-4a2 2 0 00-2-2h-4V6a2 2 0 00-2-2H4zm2 6a2 2 0 100-4 2 2 0 000 4zm8-2a2 2 0 11-4 0 2 2 0 014 0z" clip-rule="evenodd"></path></svg>
        Phân tích Văn bản
    </button>
    <input type="file" id="file-upload-input" class="hidden" accept=".pdf,.doc,.docx,.txt">
    <button id="add-doc-ai-btn" class="w-full sm:w-auto border border-blue-600 text-blue-700 font-semibold py-2.5 px-5 rounded-lg hover:bg-blue-600 hover:text-white transition duration-300 flex items-center justify-center shadow-sm hover:shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
        Thêm &amp; Phân tích bằng AI
    </button>
</div>
                    </div>
                </div>

                <div class="p-4 bg-gray-50/50 border-b border-gray-200 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div class="md:col-span-2">
                            <label for="search-input" class="sr-only">Tìm kiếm</label>
                            <input type="text" id="search-input" placeholder="Tìm kiếm công việc theo từ khóa..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                        </div>
                        <div class="flex items-center space-x-2">
                             <label for="status-filter" class="text-sm font-medium text-gray-700 whitespace-nowrap">Trạng thái:</label>
                             <select id="status-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                                <option value="all">Tất cả</option>
                                <option value="pending">Chưa hoàn thành</option>
                                <option value="completed">Đã hoàn thành</option>
                                <option value="overdue">Trễ hạn</option>
                            </select>
                        </div>
                        <button id="export-report-btn" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition duration-300 flex items-center justify-center shadow-sm hover:shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            Xuất Báo cáo
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="flex items-center space-x-2">
                             <label for="phongban-filter" class="text-sm font-medium text-gray-700 whitespace-nowrap">Phòng ban:</label>
                             <select id="phongban-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm"><option value="all">Tất cả</option></select>
                        </div>
                        <div class="flex items-center space-x-2">
                             <label for="chuyenvien-filter" class="text-sm font-medium text-gray-700 whitespace-nowrap">Chuyên viên:</label>
                             <select id="chuyenvien-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm"><option value="all">Tất cả</option></select>
                        </div>
                        <div class="flex items-center space-x-2">
                             <label for="priority-filter" class="text-sm font-medium text-gray-700 whitespace-nowrap">Mức độ:</label>
                             <select id="priority-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                                <option value="all">Tất cả</option>
                                <option value="Thường">Thường</option>
                                <option value="Quan trọng">Quan trọng</option>
                                <option value="Khẩn cấp">Khẩn cấp</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="hidden md:flex bg-gray-50 px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    <div class="w-[20%] pl-12">Số hiệu / Trích yếu</div>
                    <div class="w-[10%] text-center">Lãnh đạo</div>
                    <div class="w-[10%] text-center">Phòng ban</div>
                    <div class="w-[10%] text-center">Chuyên viên</div>
                    <div class="w-[8%] text-center sortable-header flex items-center justify-center" id="sort-priority"><span>Mức độ</span><button class="ml-1 text-gray-400 hover:text-gray-600"></button></div>
                    <div class="w-[10%] text-center">Ghi chú</div>
                    <div class="w-[10%] text-center sortable-header flex items-center justify-center" id="sort-dueDate"><span>Hạn xử lý</span><button class="ml-1 text-gray-400 hover:text-gray-600"></button></div>
                    <div class="w-[10%] text-center sortable-header flex items-center justify-center" id="sort-status"><span>Trạng thái</span><button class="ml-1 text-gray-400 hover:text-gray-600"></button></div>
                    <div class="w-[12%] text-right" id="actions-header">Thao tác</div>
                </div>

                <div id="document-list"></div>
                <div id="empty-state" class="hidden text-center p-16">
                     <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    <h3 class="mt-4 text-lg font-medium text-gray-800">Không có văn bản nào</h3>
                    <p class="mt-1 text-sm text-gray-500">Hãy nhấn nút thêm công việc để bắt đầu.</p>
                </div>
            </div>
        </div>
        
        <div id="doc-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 modal-backdrop flex items-center justify-center p-4 hidden">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-lg transform transition-all duration-300 scale-95 opacity-0 modal-content-wrapper" id="modal-content">
                <div class="flex justify-between items-center p-5 border-b sticky top-0 bg-white"><h3 class="text-xl font-semibold" id="modal-title">Thêm Văn bản mới</h3><button id="close-modal-btn" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>
                <div class="modal-body">
                    <form id="doc-form" class="p-6 space-y-4">
                        <input type="hidden" id="doc-id">
                        <div><label for="doc-title" class="block text-sm font-medium text-gray-700 mb-1">Số hiệu / Trích yếu Công việc</label><input type="text" id="doc-title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required></div>
                        <div><label for="doc-summary" class="block text-sm font-medium text-gray-700 mb-1">Nội dung tóm tắt / Yêu cầu</label><textarea id="doc-summary" spellcheck="false" rows="10" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required placeholder="Ví dụ: - Báo cáo tình hình kinh tế.&#10;- Lập danh sách hộ nghèo."></textarea></div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label for="doc-issue-date" class="block text-sm font-medium text-gray-700 mb-1">Ngày ban hành/giao</label><input type="date" id="doc-issue-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required></div>
                            <div><label for="doc-due-date" class="block text-sm font-medium text-gray-700 mb-1">Ngày đến hạn</label><input type="date" id="doc-due-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required></div>
                        </div>
                         <div><label for="select-lanh-dao" class="block text-sm font-medium text-gray-700 mb-1">Lãnh đạo xử lý</label><select id="select-lanh-dao" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></select></div>
                         <div><label for="select-phong-ban" class="block text-sm font-medium text-gray-700 mb-1">Phòng ban xử lý chính</label><select id="select-phong-ban" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></select></div>
                         <div><label for="select-chuyen-vien" class="block text-sm font-medium text-gray-700 mb-1">Chuyên viên xử lý chính</label><select id="select-chuyen-vien" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></select></div>
                        
                         <div class="border-t border-gray-200 pt-4 mt-4">
                            <h4 class="text-md font-semibold text-gray-800 mb-2">Phân công Phối hợp (nếu có)</h4>
                             <div><label for="select-phong-ban-phoihop" class="block text-sm font-medium text-gray-700 mb-1">Phòng ban Phối hợp</label><select id="select-phong-ban-phoihop" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></select></div>
                             <div class="mt-4"><label for="select-chuyen-vien-phoihop" class="block text-sm font-medium text-gray-700 mb-1">Chuyên viên Phối hợp</label><select id="select-chuyen-vien-phoihop" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></select></div>
                         </div>
                         <div><label for="doc-priority" class="block text-sm font-medium text-gray-700 mb-1">Mức độ quan trọng</label><select id="doc-priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"><option value="Thường">Thường</option><option value="Quan trọng">Quan trọng</option><option value="Khẩn cấp">Khẩn cấp</option></select></div>
                        
                        <div class="flex items-center justify-between">
                            <div><label for="doc-status" class="block text-sm font-medium text-gray-700 mb-1">Trạng thái</label><select id="doc-status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"><option value="pending">Chưa hoàn thành</option><option value="completed">Đã hoàn thành</option></select></div>
                            <div class="pt-6">
                                <label for="doc-recurring" class="block text-sm font-medium text-gray-700 mb-1">Công việc thường xuyên</label>
                                <select id="doc-recurring" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                    <option value="none">Không lặp lại</option>
                                    <option value="daily">Hàng ngày</option>
                                    <option value="weekly">Hàng tuần</option>
                                    <option value="monthly">Hàng tháng</option>
                                </select>
                            </div>
                        </div>
                        <div class="pt-2"><label for="doc-notes" class="block text-sm font-medium text-gray-700 mb-1">Ghi chú / Cập nhật tiến độ</label><textarea id="doc-notes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Thêm ghi chú nếu cần..."></textarea></div>
                    </form>
                </div>
                <div class="flex justify-end p-5 border-t sticky bottom-0 bg-white"><button type="button" id="cancel-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 mr-3">Hủy bỏ</button><button type="submit" form="doc-form" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700">Lưu lại</button></div>
            </div>
        </div>
        
        <div id="notes-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 modal-backdrop flex items-center justify-center p-4 hidden">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md transform transition-all duration-300 scale-95 opacity-0 modal-content-wrapper" id="notes-modal-content">
                <div class="flex justify-between items-center p-5 border-b"><h3 class="text-xl font-semibold">Cập nhật Ghi chú</h3><button id="close-notes-modal-btn" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>
                <form id="notes-form" class="p-6 space-y-4 modal-body">
                    <input type="hidden" id="notes-doc-id">
                    <div>
                        <label for="edit-doc-notes" class="block text-sm font-medium text-gray-700 mb-1">Nội dung Ghi chú / Cập nhật tiến độ</label>
                        <textarea id="edit-doc-notes" rows="8" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Thêm hoặc chỉnh sửa ghi chú..."></textarea>
                    </div>
                </form>
                <div class="flex justify-end p-5 border-t"><button type="button" id="cancel-notes-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 mr-3">Hủy bỏ</button><button type="submit" form="notes-form" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700">Lưu Ghi chú</button></div>
            </div>
        </div>

        <div id="export-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 modal-backdrop flex items-center justify-center p-4 hidden">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md transform transition-all duration-300 scale-95 opacity-0 modal-content-wrapper" id="export-modal-content">
                <div class="flex justify-between items-center p-5 border-b"><h3 class="text-xl font-semibold">Tùy chọn Xuất Báo cáo</h3><button id="close-export-modal-btn" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>
                <div class="p-6 space-y-3">
                    <p class="text-sm text-gray-600">Chọn loại báo cáo đồng chí muốn xuất. Báo cáo sẽ được tạo dưới dạng tệp HTML có thể in.</p>
                    <button data-type="all" class="export-option-btn w-full text-left bg-gray-100 hover:bg-blue-100 text-gray-800 font-semibold py-3 px-4 rounded-lg transition duration-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 1a4 4 0 00-4 4v10a4 4 0 004 4h10a4 4 0 004-4V5a4 4 0 00-4-4H5z" /></svg>
                        Xuất Toàn bộ Công việc
                    </button>
                    <button data-type="completed" class="export-option-btn w-full text-left bg-gray-100 hover:bg-green-100 text-gray-800 font-semibold py-3 px-4 rounded-lg transition duration-300 flex items-center">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                        Xuất việc Đã Hoàn thành
                    </button>
                    <button data-type="pending" class="export-option-btn w-full text-left bg-gray-100 hover:bg-yellow-100 text-gray-800 font-semibold py-3 px-4 rounded-lg transition duration-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-yellow-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9 5a1 1 0 112 0v5a1 1 0 11-2 0V5zm2 11a1 1 0 10-2 0 1 1 0 002 0z" clip-rule="evenodd" /></svg>
                        Xuất việc Đang Xử lý
                    </button>
                     <button data-type="overdue" class="export-option-btn w-full text-left bg-gray-100 hover:bg-red-100 text-gray-800 font-semibold py-3 px-4 rounded-lg transition duration-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-red-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                        Xuất việc Bị Trễ hạn
                    </button>
                </div>
                <div class="flex justify-end p-5 border-t"><button type="button" id="cancel-export-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">Đóng</button></div>
            </div>
        </div>

        <div id="loader-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-60 loader-backdrop flex-col items-center justify-center hidden"><div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24 mb-4"></div><h2 class="text-center text-white text-xl font-semibold">AI đang đọc và phân tích...</h2><p class="w-1/3 text-center text-white mt-2">Vui lòng chờ trong giây lát. Hệ thống đang trích xuất thông tin từ nội dung văn bản.</p></div>
        
        <footer class="text-center py-6 text-sm text-gray-500">
            <p>Sản phẩm do <strong>NGUYỄN CÔNG HIẾU- 0915.123.112</strong> - Phòng Kinh tế (VĂN MINH DIỆU- PHẠM THỊ HỒNG)- Lãnh đạo UBND xã Đức Lập (NGUYỄN VĂN TUẤN) nghiên cứu và phát triển</p>
        </footer>
    </div>
    <div id="text-analysis-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 modal-backdrop flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl transform transition-all duration-300 scale-95 opacity-0 flex flex-col" style="max-height: 90vh;">
            <div class="flex justify-between items-center p-5 border-b">
                <h3 class="text-xl font-semibold">Phân tích nội dung văn bản bằng AI</h3>
                <button id="close-text-modal-btn" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>
            <div class="p-6 overflow-y-auto">
                <label for="text-analysis-input" class="block text-sm font-medium text-gray-700 mb-2">Dán nội dung văn bản cần phân tích vào đây:</label>
                <textarea id="text-analysis-input" rows="15" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Nhập hoặc dán nội dung chỉ đạo, công văn, thông báo..."></textarea>
            </div>
            <div class="flex justify-end p-5 border-t bg-gray-50">
                <button type="button" id="cancel-text-analysis-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 mr-3">Hủy bỏ</button>
                <button type="button" id="submit-text-analysis-btn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700">Bắt đầu Phân tích</button>
            </div>
        </div>
    </div>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  // BỔ SUNG: Import các hàm cần thiết của Firestore
  import { getFirestore, collection, getDocs, doc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBA98rptMynXX3yVaT9Q9_O8aCcuay8xKY",
    authDomain: "quan-ly-cong-viec-dl.firebaseapp.com",
    projectId: "quan-ly-cong-viec-dl",
    storageBucket: "quan-ly-cong-viec-dl.firebasestorage.app",
    messagingSenderId: "415835641693",
    appId: "1:415835641693:web:fabad6ce3f60c0ff6a3ab4"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  // BỔ SUNG: Khởi tạo dịch vụ Firestore và export để script chính có thể sử dụng
window.firebase = {
  db: getFirestore(app),
  collection,
  getDocs,
  doc,
  setDoc,
  deleteDoc
};
</script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
const { db, collection, getDocs, doc, setDoc, deleteDoc } = window.firebase; // Import đối tượng 'db' từ script module ở trên
            // =============================================================
            // KHAI BÁO BIẾN VÀ DOM ELEMENTS
            // =============================================================
            const loginScreen = document.getElementById('login-screen');
            const appScreen = document.getElementById('app-screen');
            const loginForm = document.getElementById('login-form');
            const loginError = document.getElementById('login-error');
            const logoutBtn = document.getElementById('logout-btn');
            
            const kpiTotalCard = document.getElementById('card-total');
            const kpiCompletedCard = document.getElementById('card-completed');
            const kpiPendingCard = document.getElementById('card-pending');
            const kpiOverdueCard = document.getElementById('card-overdue');

            const addDocAIBtn = document.getElementById('add-doc-ai-btn');
            const addDocManualBtn = document.getElementById('add-doc-manual-btn');
            const fileUploadInput = document.getElementById('file-upload-input');
            const loaderOverlay = document.getElementById('loader-overlay');
            
            const modal = document.getElementById('doc-modal');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const cancelBtn = document.getElementById('cancel-btn');
            const docForm = document.getElementById('doc-form');
            const modalTitle = document.getElementById('modal-title');
            
            const notesModal = document.getElementById('notes-modal');
            const notesModalContent = document.getElementById('notes-modal-content');
            const closeNotesModalBtn = document.getElementById('close-notes-modal-btn');
            const cancelNotesBtn = document.getElementById('cancel-notes-btn');
            const notesForm = document.getElementById('notes-form');
            const notesDocIdInput = document.getElementById('notes-doc-id');
            const editDocNotesInput = document.getElementById('edit-doc-notes');

            const exportModal = document.getElementById('export-modal');
            const exportModalContent = document.getElementById('export-modal-content');
            const closeExportModalBtn = document.getElementById('close-export-modal-btn');
            const cancelExportBtn = document.getElementById('cancel-export-btn');

            const documentList = document.getElementById('document-list');
            const emptyState = document.getElementById('empty-state');
            
            const searchInput = document.getElementById('search-input');
            const statusFilter = document.getElementById('status-filter');
            const phongbanFilter = document.getElementById('phongban-filter');
            const chuyenvienFilter = document.getElementById('chuyenvien-filter');
            const priorityFilter = document.getElementById('priority-filter');
            const exportReportBtn = document.getElementById('export-report-btn');

            const sortHeaders = {
                priority: document.getElementById('sort-priority'),
                dueDate: document.getElementById('sort-dueDate'),
                status: document.getElementById('sort-status'),
            };
            
            const docIdInput = document.getElementById('doc-id');
            const docTitleInput = document.getElementById('doc-title');
            const docSummaryInput = document.getElementById('doc-summary');
            const docNotesInput = document.getElementById('doc-notes');
            const docIssueDateInput = document.getElementById('doc-issue-date');
            const docDueDateInput = document.getElementById('doc-due-date');
            const docStatusInput = document.getElementById('doc-status');
            const docRecurringInput = document.getElementById('doc-recurring');
            const docPriorityInput = document.getElementById('doc-priority');
            const selectLanhDao = document.getElementById('select-lanh-dao');
            const selectPhongBan = document.getElementById('select-phong-ban');
            const selectChuyenVien = document.getElementById('select-chuyen-vien');
            
            // Khai báo biến cho chức năng phân tích văn bản
            const addTextAIBtn = document.getElementById('add-text-ai-btn');
            const textAnalysisModal = document.getElementById('text-analysis-modal');
            const closeTextModalBtn = document.getElementById('close-text-modal-btn');
            const cancelTextAnalysisBtn = document.getElementById('cancel-text-analysis-btn');
            const submitTextAnalysisBtn = document.getElementById('submit-text-analysis-btn');
            const textAnalysisInput = document.getElementById('text-analysis-input');

            // Khai báo biến cho chức năng phối hợp
            const selectPhongBanPhoiHop = document.getElementById('select-phong-ban-phoihop');
            const selectChuyenVienPhoiHop = document.getElementById('select-chuyen-vien-phoihop');
		
            let documents = [];
            let sortBy = 'dueDate'; 
            let sortOrder = 'asc'; 
            let currentUserRole = '';

            // =============================================================
            // DỮ LIỆU NHÂN SỰ (HARDCODED)
            // =============================================================
function findAndSelectPersonnel(selectElement, personnelName) {
    if (!personnelName || !selectElement) return;
    const options = Array.from(selectElement.options);
    const bestMatch = options.find(option => option.value.toLowerCase().includes(personnelName.toLowerCase()));
    if (bestMatch) {
        selectElement.value = bestMatch.value;
        selectElement.dispatchEvent(new Event('change'));
    }
}            
const allPersonnel = [
    { name: 'Nguyễn Hữu Phố (Chủ tịch)', rank: 1, department: 'UBND' },
                { name: 'Nguyễn Văn Tuấn (P. Chủ tịch)', rank: 2, department: 'UBND' },
                { name: 'Đinh Thanh Hải (P. Chủ tịch)', rank: 2, department: 'UBND' },
                { name: 'Văn Minh Diệu (Trưởng phòng KT)', rank: 3, department: 'KT' },
                { name: 'Phạm Thị Hồng (Phó Trưởng phòng KT)', rank: 4, department: 'KT' },
                { name: 'Phạm Khắc Chung (Trưởng phòng VHXH)', rank: 3, department: 'VHXH' },
                { name: 'Nguyễn Thị Phương (Phó Trưởng phòng VHXH)', rank: 4, department: 'VHXH' },
                { name: 'Trần Văn Giới (Chánh VP)', rank: 3, department: 'VP' },
                { name: 'Điểu Lê Nam Nam (Phó Chánh VP)', rank: 4, department: 'VP' },
                { name: 'Trần Văn Long (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Võ Thị Hà Phương (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Trần Thị Quỳnh Trang (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Nguyễn Thị Lài (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Ngô Hoàng Hiệp (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Võ Sỹ Ngọc Hoàng (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Nguyễn Công Hiếu (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Phan Thị Việt Trinh (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Nguyễn Sỹ Hải (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Doãn Hữu Cường (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Nguyễn Sỹ Anh (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Đỗ Thị Dung (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Đặng Hồng Khanh (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Trần Thị Thu Hiền (Chuyên viên KT)', rank: 5, department: 'KT' },
                { name: 'Trần Quốc Hoàn (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Huỳnh Quốc Toàn (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Hoàng Thị Thu Bắc (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Trần Thị Hồng Hạnh (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Sào Thị Lưu (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Đặng Thị Tin (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Trần Văn Trọng (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Nguyễn Thị Vân (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Ngô Thị Thuý (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Phạm Nữ Mỹ Duyên (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Nguyễn Thị Kim Oanh (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Đào Thị Trường Giang (Chuyên viên VHXH)', rank: 5, department: 'VHXH' },
                { name: 'Lữ Minh Quân (Kế toán VP)', rank: 5, department: 'VP' },
                { name: 'Nguyễn Thị Thu Thảo (Chuyên viên VP)', rank: 5, department: 'VP' },
                { name: 'Võ Ngọc Huy (Chuyên viên VP)', rank: 5, department: 'VP' },
                { name: 'Trần Anh Quyết (Chuyên viên VP)', rank: 5, department: 'VP' },
                { name: 'Nguyễn Minh Hạ (Chuyên viên VP)', rank: 5, department: 'VP' },
                { name: 'Phan Văn Phúc (Chuyên viên VP)', rank: 5, department: 'VP' },
                { name: 'Hoàng Thị Trà (Chuyên viên VP)', rank: 5, department: 'VP' },
                { name: 'Phương Dương Giang (Chuyên viên VP)', rank: 5, department: 'VP' },
                { name: 'Nguyễn Thị Bích Hạnh (Chuyên viên VP)', rank: 5, department: 'VP' },
                
                // ===== BẮT ĐẦU PHẦN BỔ SUNG MỚI TỪ THÔNG BÁO 02/TB-HCC =====
                { name: 'Đinh Văn Bình (Phó Giám đốc HCC)', rank: 4, department: 'HCC' },
                { name: 'Đoàn Thị Hương Sen (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                { name: 'Võ Thị Bích Phương (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                { name: 'Bùi Lê Cao Trí (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                { name: 'Đậu Thị Thanh Thảo (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                { name: 'Nguyễn Thị Hương (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                { name: 'Nguyễn Đức Lập (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                { name: 'Tô Thị Thúy Phượng (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                { name: 'Lê Văn Giang (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                { name: 'Võ Thị Ái Phi (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                { name: 'Phan Ngọc Long (Chuyên viên HCC)', rank: 5, department: 'HCC' },
                // ===== KẾT THÚC PHẦN BỔ SUNG MỚI =====
            ];

            // =============================================================
            // QUẢN LÝ XÁC THỰC VÀ PHÂN QUYỀN
            // =============================================================
            
            function handleLogin(e) {
                e.preventDefault();
                const username = e.target.username.value;
                const password = e.target.password.value;

                if (username === 'admin' && password === 'admin123') {
                    sessionStorage.setItem('userRole', 'admin');
                    initializeApp();
                } else if (username === 'user' && password === 'user123') {
                    sessionStorage.setItem('userRole', 'viewer');
                    initializeApp();
                } else {
                    loginError.classList.remove('hidden');
                }
            }

            function handleLogout() {
                sessionStorage.removeItem('userRole');
                location.reload();
            }

            const preventDefaultAction = event => event.preventDefault();
            function blockShortcuts(e) {
                if (e.ctrlKey && ['s', 'u', 'c', 'p', 'x', 'a', 'i', 'j'].includes(e.key.toLowerCase())) e.preventDefault();
                if (e.key === 'F12') e.preventDefault();
            }

            function applyPermissions() {
                const adminControls = document.getElementById('admin-controls');
                const actionsHeader = document.getElementById('actions-header');

                document.removeEventListener('contextmenu', preventDefaultAction);
                document.removeEventListener('keydown', blockShortcuts);
                document.body.removeEventListener('copy', preventDefaultAction);
                document.body.removeEventListener('cut', preventDefaultAction);
                appScreen.classList.remove('protected-content');
                
                if (currentUserRole === 'viewer') {
                    adminControls.classList.add('hidden');
                    actionsHeader.classList.add('hidden');
                    appScreen.classList.add('protected-content');
                    document.addEventListener('contextmenu', preventDefaultAction);
                    document.addEventListener('keydown', blockShortcuts);
                    document.body.addEventListener('copy', preventDefaultAction);
                    document.body.addEventListener('cut', preventDefaultAction);
                } else {
                    adminControls.classList.remove('hidden');
                    actionsHeader.classList.remove('hidden');
                }
                renderAll();
            }
           
function formatSummary(summaryText, doc) {
                // [NÂNG CẤP] - Tự động dọn dẹp các ký tự thừa từ AI
                if (typeof summaryText === 'string') {
                    summaryText = summaryText
                        .replace(/`+/g, '') // Xóa các dấu backtick
                        .replace(/['"\[\]{}]/g, '') // Xóa các loại dấu ngoặc kép, ngoặc vuông, ngoặc nhọn
                        .replace(/^\s*[:*\-]\s*/gm, '') // Xóa các dấu gạch đầu dòng, sao, hai chấm ở đầu dòng
                        .replace(/\\n/g, '\n') // Chuyển ký tự xuống dòng \\n thành xuống dòng thật
                        .trim();
                }

                let html = '';
                if (summaryText && summaryText.trim() !== '') {
                    const iconMap = { 'Yêu cầu': '🎯', 'Mục tiêu': '🎯', 'Nhiệm vụ': '📌', 'Nội dung': '📋', 'Thực hiện': '▶️', 'Triển khai': '🚀', 'Tổ chức': '📅', 'Chỉ đạo': '👉', 'Phê duyệt': '✅', 'Giải quyết': '💡', 'Xử lý': '⚙️', 'Đôn đốc': '🏃‍♂️', 'Hướng dẫn': 'ℹ️', 'Phổ biến': '📡', 'Tuyên truyền': '📰', 'Sản phẩm': '📦', 'Kết quả': '🏆', 'Hoàn thành': '🏁', 'Thời hạn': '⏳', 'Hạn xử lý': '⏳', 'Thời gian': '⏰', 'Tiến độ': '📈', 'Khẩn': '🚨', 'Hỏa tốc': '🔥', 'Mật': '🤫', 'Phối hợp': '🤝', 'Chủ trì': '👤', 'Thành viên': '👥', 'Lãnh đạo': '⭐', 'Công dân': '👨‍👩‍👧‍👦', 'Doanh nghiệp': '💼', 'Ghi chú': '📝', 'Kế hoạch': '🗺️', 'Phương án': '🧭', 'Công văn': '✉️', 'Thông báo': '📢', 'Tờ trình': '📤', 'Giấy mời': '💌', 'Tài liệu': '📄', 'Hồ sơ': '📁', 'Báo cáo': '📊', 'Dự thảo': '✍️', 'Quyết định': '⚖️', 'Nghị quyết': '📜', 'Hợp đồng': '📑', 'Kinh phí': '💰', 'Ngân sách': '💵', 'Dự toán': '🧾', 'Tài chính': '🪙', 'Tài sản': '🏦', 'Nguồn lực': '💪', 'Kiểm tra': '🔍', 'Thanh tra': '🔍', 'Giám sát': '👀', 'Rà soát': '🧐', 'Đánh giá': '💯', 'Lấy ý kiến': '🗣️', 'Họp': '👥', 'Thành lập': '🏛️', 'Xây dựng': '🏗️', 'Đất đai': '🏞️', 'Môi trường': '🌿', 'An ninh': '🛡️', 'Quốc phòng': '⚔️', 'PCCC': '🚒', 'Giao thông': '🛣️', 'Thủy lợi': '💧', 'Nông nghiệp': '🌾', 'Tư pháp': '⚖️', 'Nội vụ': '🗄️', 'Văn hóa': '🎭', 'Giáo dục': '🎓', 'Y tế': '⚕️', 'Xã hội': '❤️', 'Khiếu nại': '😠', 'Tố cáo': '🗣️', 'Khen thưởng': '🎖️', 'Kỷ luật': '📜', 'Chuyển đổi số': '🌐', 'Dữ liệu': '💾' };
                    const keywords = ['Yêu cầu', 'Sản phẩm đầu ra', 'Thời hạn', 'Đơn vị phối hợp', 'Nội dung chính', 'Mục tiêu', 'Ghi chú', 'Kinh phí', 'Báo cáo', 'Thành lập', 'Kiểm tra', 'Họp'];
                    const regex = new RegExp(`^(${keywords.join('|')}):`, 'gim');
                    const processedText = summaryText.replace(regex, '|||$1:');
                    const parts = processedText.split('|||').filter(p => p.trim() !== '');

                    if (parts.length <= 1) {
                         html = `<p class="text-gray-700 whitespace-pre-wrap">${summaryText}</p>`;
                    } else {
                        parts.forEach(part => {
                            const partSplit = part.split(/:(.*)/s);
                            const header = partSplit[0].trim();
                            const content = partSplit[1] ? partSplit[1].trim() : '';
                            if (!content) return;
                            let selectedIcon = '🔹';
                            for (const key in iconMap) {
                                if (header.toLowerCase().includes(key.toLowerCase())) {
                                    selectedIcon = iconMap[key];
                                    break;
                                }
                            }
                            html += `<div class="flex items-start mt-3"><div class="text-base mr-2 pt-1">${selectedIcon}</div><div class="flex-1"><h4 class="text-sm font-semibold text-gray-900">${header}:</h4><p class="text-sm text-gray-700 whitespace-pre-wrap">${content}</p></div></div>`;
                        });
                    }
                } else {
                    html = '<p class="text-gray-600 text-sm">Không có tóm tắt.</p>';
                }
                
                if (doc.phongBanPhoiHop) {
                    html += `
                        <div class="flex items-start mt-4 pt-3 border-t border-dashed">
                            <div class="text-base mr-2 pt-1">🤝</div>
                            <div class="flex-1">
                                <h4 class="text-sm font-semibold text-gray-900">Đơn vị phối hợp:</h4>
                                <p class="text-sm text-gray-700">${doc.phongBanPhoiHop}</p>
                                ${doc.chuyenVienPhoiHop ? `<p class="text-sm text-gray-700 mt-1"><strong>Chuyên viên:</strong> ${doc.chuyenVienPhoiHop}</p>` : ''}
                            </div>
                        </div>
                    `;
                }
                return html;
            }
            // =============================================================
            // CÁC HÀM LOGIC CỦA ỨNG DỤNG
            // =============================================================

            async function loadDocuments() {
                try {
                    const querySnapshot = await getDocs(collection(db, "documents"));
                    documents = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    console.error("Lỗi khi tải dữ liệu từ Firebase: ", error);
                    alert("Không thể kết nối đến cơ sở dữ liệu. Vui lòng kiểm tra lại kết nối mạng.");
                    documents = []; // Reset về mảng rỗng nếu lỗi
                }
            }
            
            function getWeekInfo(d) {
                const date = new Date(d);
                date.setHours(0, 0, 0, 0);
                const day = date.getDay();
                const diff = date.getDate() - day + (day === 0 ? -6 : 1);
                const startOfWeek = new Date(date.setDate(diff));
                const endOfWeek = new Date(new Date(startOfWeek).setDate(startOfWeek.getDate() + 6));
                const onejan = new Date(startOfWeek.getFullYear(), 0, 1);
                const weekNumber = Math.ceil((((startOfWeek - onejan) / 86400000) + onejan.getDay() + 1) / 7);
                return { weekNumber, year: startOfWeek.getFullYear(), start: startOfWeek, end: endOfWeek, key: `${startOfWeek.getFullYear()}-${weekNumber}` };
            }

            function calculateDaysRemaining(dueDateString) {
                const today = new Date();
                const dueDate = new Date(dueDateString);
                today.setHours(0, 0, 0, 0);
                dueDate.setHours(0, 0, 0, 0);
                return Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
            }

            function getStatusInfo(days, status) {
                if (status === 'completed') return { text: 'Hoàn thành', color: 'bg-gray-400 text-gray-800' };
                if (days < 0) return { text: `Trễ ${Math.abs(days)} ngày`, color: 'bg-red-600 text-white font-bold' };
                if (days === 0) return { text: `Hạn hôm nay`, color: 'bg-red-500 text-white' };
                if (days <= 3) return { text: `Còn ${days} ngày`, color: 'bg-yellow-500 text-white' };
                return { text: `Còn ${days} ngày`, color: 'bg-green-500 text-white' };
            }

            function getPriorityInfo(priority) {
                switch (priority) {
                    case 'Khẩn cấp': return { text: 'Khẩn cấp', color: 'bg-red-600 text-white' };
                    case 'Quan trọng': return { text: 'Quan trọng', color: 'bg-yellow-500 text-white' };
                    default: return { text: 'Thường', color: 'bg-blue-500 text-white' };
                }
            }

            function updateSortButtons() {
                const downArrow = `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>`;
                const upArrow = `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd"></path></svg>`;
                Object.keys(sortHeaders).forEach(key => {
                    const button = sortHeaders[key].querySelector('button');
                    button.innerHTML = key === sortBy ? (sortOrder === 'desc' ? downArrow : upArrow) : '';
                });
            }

            function renderDashboard() {
                const total = documents.length;
                const completed = documents.filter(d => d.status === 'completed').length;
                const pending = documents.filter(d => d.status === 'pending' && calculateDaysRemaining(d.dueDate) >= 0).length;
                const overdue = documents.filter(d => d.status === 'pending' && calculateDaysRemaining(d.dueDate) < 0).length;
                document.getElementById('kpi-total').textContent = total;
                document.getElementById('kpi-completed').textContent = completed;
                document.getElementById('kpi-pending').textContent = pending;
                document.getElementById('kpi-overdue').textContent = overdue;
            }

            function renderAll() {
                renderDashboard();
                renderDocuments();
            }
            
            function renderDocuments() {
                documentList.innerHTML = '';
                let filteredDocuments = documents.filter(doc => {
                    const searchTerm = searchInput.value.toLowerCase();
                    const status = statusFilter.value;
                    const phongBan = phongbanFilter.value;
                    const chuyenVien = chuyenvienFilter.value;
                    const priority = priorityFilter.value;
                    if (searchTerm && !(doc.title.toLowerCase().includes(searchTerm) || doc.summary.toLowerCase().includes(searchTerm) || (doc.notes && doc.notes.toLowerCase().includes(searchTerm)))) return false;
                    if (status !== 'all') {
                         if (status === 'overdue') { if (doc.status !== 'pending' || calculateDaysRemaining(doc.dueDate) >= 0) return false; } 
                         else if (status === 'pending') { if (doc.status !== 'pending' || calculateDaysRemaining(doc.dueDate) < 0) return false; }
                         else if (doc.status !== status) return false;
                    }
                    if (phongBan !== 'all' && doc.phongBan !== phongBan) return false;
                    if (chuyenVien !== 'all' && doc.chuyenVien !== chuyenVien) return false;
                    if (priority !== 'all' && doc.priority !== priority) return false;
                    return true;
                });
                emptyState.classList.toggle('hidden', filteredDocuments.length > 0);
                const priorityOrder = { 'Khẩn cấp': 3, 'Quan trọng': 2, 'Thường': 1 };
                const docsByWeek = {};
                const currentWeekInfo = getWeekInfo(new Date());
                filteredDocuments.forEach(doc => {
                    let weekInfo = (doc.status === 'pending' && new Date(doc.dueDate) < currentWeekInfo.start) ? currentWeekInfo : getWeekInfo(new Date(doc.dueDate));
                    if (!docsByWeek[weekInfo.key]) docsByWeek[weekInfo.key] = { info: weekInfo, docs: [] };
                    docsByWeek[weekInfo.key].docs.push(doc);
                });

                Object.keys(docsByWeek).sort((a, b) => b.localeCompare(a)).forEach(weekKey => {
                    const weekData = docsByWeek[weekKey];
                    const weekHeader = document.createElement('div');
                    weekHeader.className = 'week-header px-6 py-2 text-sm sticky top-0 z-0';
                    weekHeader.textContent = `TUẦN ${weekData.info.weekNumber} (${weekData.info.start.toLocaleDateString('vi-VN')} - ${weekData.info.end.toLocaleDateString('vi-VN')})`;
                    documentList.appendChild(weekHeader);

                    weekData.docs.sort((a, b) => {
                        let compare = 0;
                        if (sortBy === 'priority') compare = (priorityOrder[b.priority] || 0) - (priorityOrder[a.priority] || 0);
                        else if (sortBy === 'dueDate') compare = new Date(a.dueDate) - new Date(b.dueDate);
                        else if (sortBy === 'status') compare = a.status.localeCompare(b.status);
                        return sortOrder === 'desc' ? -compare : compare;
                    }).forEach(doc => {
                        const daysRemaining = calculateDaysRemaining(doc.dueDate);
                        const { text: statusText, color: statusColor } = getStatusInfo(daysRemaining, doc.status);
                        const { text: priorityText, color: priorityColor } = getPriorityInfo(doc.priority);
                        const summaryHtml = formatSummary(doc.summary, doc);
                        const notesHtml = doc.notes ? `<h4 class="text-sm font-semibold text-gray-700 mt-4 mb-2">Lịch sử Ghi chú:</h4><div class="text-gray-600 text-sm whitespace-pre-wrap bg-yellow-50 p-3 rounded-md">${doc.notes}</div>` : '';
                        const isCompleted = doc.status === 'completed';
                        const docWrapper = document.createElement('div');
                        docWrapper.className = `document-wrapper ${isCompleted ? 'opacity-60' : ''}`;
                        let recurringIcon = '';
                        if (doc.recurringType === 'daily') recurringIcon = '☀️';
                        else if (doc.recurringType === 'weekly') recurringIcon = '📅';
                        else if (doc.recurringType === 'monthly') recurringIcon = '🈷️';
                        if (recurringIcon) recurringIcon = `<span class="inline-block mr-1" title="Lặp lại ${doc.recurringType}">${recurringIcon}</span>`;
                        const actionButtonsHtml = currentUserRole === 'admin' ? `
                            <div class="w-full md:w-[12%] text-left md:text-right flex items-center space-x-1">
                                <button class="status-toggle-btn p-2 text-gray-400 hover:text-green-600 rounded-full hover:bg-gray-200" data-id="${doc.id}" title="${isCompleted ? 'Mở lại công việc' : 'Đánh dấu Hoàn thành'}">${isCompleted ? `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12A8 8 0 1013 5.2"></path></svg>` : `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`}</button>
                                <button class="edit-notes-btn p-2 text-gray-400 hover:text-yellow-600 rounded-full hover:bg-gray-200" data-id="${doc.id}" title="Sửa Ghi chú"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg></button>
                                <button class="edit-btn p-2 text-gray-400 hover:text-blue-600 rounded-full hover:bg-gray-200" data-id="${doc.id}" title="Chỉnh sửa"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg></button>
                                <button class="delete-btn p-2 text-gray-400 hover:text-red-600 rounded-full hover:bg-gray-200" data-id="${doc.id}" title="Xóa"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                            </div>` : '<div class="w-full md:w-[12%]"></div>';
                        const noteSnippet = doc.notes ? doc.notes.split('\n')[0].substring(0, 30) + (doc.notes.length > 30 ? '...' : '') : '-';
                        docWrapper.innerHTML = `
                            <div class="document-row flex flex-col md:flex-row md:items-center px-6 py-4 border-b border-gray-200 transition duration-200 ${isCompleted ? 'bg-gray-50' : 'bg-white'}">
                                <div class="w-full md:w-[20%] flex items-center mb-4 md:mb-0">
                                    <button class="details-btn p-1 rounded-full hover:bg-gray-200" data-target="summary-${doc.id}"><svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                                    <div class="ml-2"><div class="text-sm font-semibold text-gray-800 ${isCompleted ? 'line-through' : ''}">${recurringIcon}${doc.title}</div></div>
                                </div>
                                <div class="w-full md:w-[10%] text-left md:text-center text-sm text-gray-600 mb-2 md:mb-0"><span class="md:hidden font-medium text-gray-500">Lãnh đạo: </span>${doc.lanhDao || '-'}</div>
                                <div class="w-full md:w-[10%] text-left md:text-center text-sm text-gray-600 mb-2 md:mb-0"><span class="md:hidden font-medium text-gray-500">Phòng ban: </span>${doc.phongBan || '-'}</div>
                                <div class="w-full md:w-[10%] text-left md:text-center text-sm text-gray-600 mb-2 md:mb-0"><span class="md:hidden font-medium text-gray-500">Chuyên viên: </span>${doc.chuyenVien || '-'}</div>
                                <div class="w-full md:w-[8%] text-left md:text-center text-sm mb-4 md:mb-0"><span class="px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${priorityColor}">${priorityText}</span></div>
                                <div class="w-full md:w-[10%] text-left md:text-center text-sm text-gray-500 mb-2 md:mb-0"><span class="md:hidden font-medium text-gray-500">Ghi chú: </span>${noteSnippet}</div>
                                <div class="w-full md:w-[10%] text-left md:text-center text-sm text-gray-600 mb-2 md:mb-0"><span class="md:hidden font-medium text-gray-500">Ngày đến hạn: </span><div>${new Date(doc.dueDate).toLocaleDateString('vi-VN')}</div></div>
                                <div class="w-full md:w-[10%] text-left md:text-center text-sm mb-4 md:mb-0"><span class="px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">${statusText}</span></div>
                                ${actionButtonsHtml}
                            </div>
                            <div id="summary-${doc.id}" class="summary-content bg-white border-b border-gray-200">
                                <div class="px-6 py-4 pl-16">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-2">Tóm tắt nội dung:</h4>
                                    ${summaryHtml}
                                    ${notesHtml}
                                </div>
                            </div>`;
                        documentList.appendChild(docWrapper);
                    });
                });
                attachActionListeners();
                updateSortButtons();
            }

            function attachActionListeners() {
                if (currentUserRole === 'admin') {
                    document.querySelectorAll('.edit-btn').forEach(b => b.addEventListener('click', handleEdit));
                    document.querySelectorAll('.delete-btn').forEach(b => b.addEventListener('click', handleDelete));
                    document.querySelectorAll('.status-toggle-btn').forEach(b => b.addEventListener('click', handleStatusChange));
                    document.querySelectorAll('.edit-notes-btn').forEach(b => b.addEventListener('click', handleEditNotes));
                }
                document.querySelectorAll('.details-btn').forEach(b => b.addEventListener('click', handleToggleSummary));
            }
            
            function handleToggleSummary(e) {
                const button = e.currentTarget;
                const targetId = button.dataset.target;
                const summaryContent = document.getElementById(targetId);
                if (summaryContent) {
                    button.classList.toggle('open');
                    summaryContent.classList.toggle('open');
                }
            }

            function populateAllDropdowns() {
                const allOption = '<option value="all">Tất cả</option>';
                const phongBanList = [...new Set(allPersonnel.filter(p => p.rank > 2 && p.rank <= 4).map(p => p.name))];
                const chuyenVienList = [...new Set(allPersonnel.filter(p => p.rank > 4).map(p => p.name))];
                phongbanFilter.innerHTML = allOption + phongBanList.map(p => `<option value="${p}">${p}</option>`).join('');
                chuyenvienFilter.innerHTML = allOption + chuyenVienList.map(p => `<option value="${p}">${p}</option>`).join('');
            }
            
            function populateModalDropdowns(doc = {}) {
                const defaultOption = '<option value="">-- Chọn --</option>';
                selectLanhDao.innerHTML = defaultOption + allPersonnel.filter(p => p.rank <= 2).map(p => `<option value="${p.name}">${p.name}</option>`).join('');
                
                const phongBanList = allPersonnel.filter(p => p.rank > 2 && p.rank <= 4);
                const phongBanOptions = defaultOption + phongBanList.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
                selectPhongBan.innerHTML = phongBanOptions;
                selectPhongBanPhoiHop.innerHTML = phongBanOptions;

                const populateChuyenVienDropdown = (phongBanSelect, chuyenVienSelect, selectedChuyenVienName) => {
                    const selectedPhongBanName = phongBanSelect.value;
                    const manager = allPersonnel.find(p => p.name === selectedPhongBanName);
                    let chuyenVienOptions = allPersonnel.filter(p => p.rank > 4);
                    if (manager) {
                        chuyenVienOptions = allPersonnel.filter(p => p.rank > 4 && p.department === manager.department);
                    }
                    chuyenVienSelect.innerHTML = defaultOption + chuyenVienOptions.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
                    if(selectedChuyenVienName) findAndSelectPersonnel(chuyenVienSelect, selectedChuyenVienName);
                };
                
                // Sử dụng hàm findAndSelectPersonnel để chọn giá trị
                findAndSelectPersonnel(selectLanhDao, doc.lanhDao);
                findAndSelectPersonnel(selectPhongBan, doc.phongBan);
                populateChuyenVienDropdown(selectPhongBan, selectChuyenVien, doc.chuyenVien);
                
                findAndSelectPersonnel(selectPhongBanPhoiHop, doc.phongBanPhoiHop);
                populateChuyenVienDropdown(selectPhongBanPhoiHop, selectChuyenVienPhoiHop, doc.chuyenVienPhoiHop);
            }

            function openModal(doc = null) {
                docForm.reset();
                if (doc) {
                    modalTitle.textContent = doc.id ? 'Cập nhật Công việc' : 'Xác nhận thông tin từ AI';
                    docIdInput.value = doc.id || '';
                    docTitleInput.value = doc.title || '';

                    // [FIX] Xử lý lỗi [object Object]
                    let summaryText = doc.summary;
                    if (typeof summaryText === 'object' && summaryText !== null) {
                        summaryText = JSON.stringify(summaryText, null, 2); // Chuyển object thành chuỗi JSON để hiển thị
                    }
                    docSummaryInput.value = summaryText || '';

                    docNotesInput.value = doc.notes || '';
                    docIssueDateInput.value = doc.issueDate || new Date().toISOString().slice(0, 10);
                    docDueDateInput.value = doc.dueDate || new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10);
                    docStatusInput.value = doc.status || 'pending';
                    docPriorityInput.value = doc.priority || 'Thường';
                    docRecurringInput.value = doc.recurringType || 'none';
                    populateModalDropdowns(doc);
                } else {
                    modalTitle.textContent = 'Thêm Công việc mới';
                    docIdInput.value = '';
                    docIssueDateInput.value = new Date().toISOString().slice(0, 10);
                    docDueDateInput.value = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10);
                    populateModalDropdowns();
                }
                modal.classList.remove('hidden');
                setTimeout(() => { modal.classList.add('opacity-100'); modalContent.classList.remove('scale-95', 'opacity-0'); }, 10);
            }

            function closeModal() {
                modalContent.classList.add('scale-95', 'opacity-0');
                modal.classList.remove('opacity-100');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
            
            function openNotesModal(doc) {
                notesDocIdInput.value = doc.id;
                editDocNotesInput.value = doc.notes || '';
                notesModal.classList.remove('hidden');
                setTimeout(() => { notesModal.classList.add('opacity-100'); notesModalContent.classList.remove('scale-95', 'opacity-0'); }, 10);
            }

            function closeNotesModal() {
                notesModalContent.classList.add('scale-95', 'opacity-0');
                notesModal.classList.remove('opacity-100');
                setTimeout(() => notesModal.classList.add('hidden'), 300);
            }

            function openExportModal() {
                exportModal.classList.remove('hidden');
                setTimeout(() => { exportModal.classList.add('opacity-100'); exportModalContent.classList.remove('scale-95', 'opacity-0'); }, 10);
            }

            function closeExportModal() {
                exportModalContent.classList.add('scale-95', 'opacity-0');
                exportModal.classList.remove('opacity-100');
                setTimeout(() => exportModal.classList.add('hidden'), 300);
            }

            async function handleSubmit(e) {
                e.preventDefault();
                const id = docIdInput.value;
                const docData = {
                    title: docTitleInput.value, summary: docSummaryInput.value, notes: docNotesInput.value,
                    issueDate: docIssueDateInput.value, dueDate: docDueDateInput.value, lanhDao: selectLanhDao.value,
                    phongBan: selectPhongBan.value, chuyenVien: selectChuyenVien.value, 
                    phongBanPhoiHop: selectPhongBanPhoiHop.value, chuyenVienPhoiHop: selectChuyenVienPhoiHop.value,
                    status: docStatusInput.value, priority: docPriorityInput.value, recurringType: docRecurringInput.value,
                };

                try {
                    if (id) { // Cập nhật công việc đã có
                        const docRef = doc(db, "documents", id);
                        await setDoc(docRef, docData, { merge: true }); // Dùng merge để không ghi đè các trường khác
                        const index = documents.findIndex(d => d.id == id);
                        if (index !== -1) documents[index] = { ...documents[index], ...docData };
                    } else { // Thêm công việc mới
                        const newDocRef = doc(collection(db, "documents")); // Tự tạo ID mới
                        docData.id = newDocRef.id;
                        await setDoc(newDocRef, docData);
                        documents.push(docData);
                    }
                    renderAll();
                    closeModal();
                } catch (error) {
                    console.error("Lỗi khi lưu dữ liệu: ", error);
                    alert("Đã xảy ra lỗi khi lưu công việc. Vui lòng thử lại.");
                }
            }

            function handleEdit(e) {
                const id = e.currentTarget.dataset.id;
                const docToEdit = documents.find(doc => doc.id === id);
                if (docToEdit) openModal(docToEdit);
            }
            
             function handleEditNotes(e) {
                const id = e.currentTarget.dataset.id;
                const docToEdit = documents.find(doc => doc.id === id);
                if (docToEdit) openNotesModal(docToEdit);
            }

            async function handleSaveNote(e) {
                e.preventDefault();
                const id = notesDocIdInput.value;
                const docToUpdate = documents.find(d => d.id === id);
                if (docToUpdate) {
                    const now = new Date();
                    const timestamp = `[Cập nhật lúc: ${now.toLocaleTimeString('vi-VN')} ${now.toLocaleDateString('vi-VN')}]`;
                    const newNoteContent = editDocNotesInput.value;
                    const oldNotes = docToUpdate.notes ? docToUpdate.notes.split('\n').filter(line => !line.startsWith('[Cập nhật lúc:')).join('\n').trim() : '';
                    const updatedNotes = `${timestamp}\n${newNoteContent}\n\n${oldNotes}`.trim();

                    try {
                        const docRef = doc(db, "documents", id);
                        await setDoc(docRef, { notes: updatedNotes }, { merge: true }); // Chỉ cập nhật trường notes
                        docToUpdate.notes = updatedNotes; // Cập nhật local data
                        renderAll();
                        closeNotesModal();
                    } catch (error) {
                         console.error("Lỗi khi lưu ghi chú: ", error);
                         alert("Đã xảy ra lỗi khi lưu ghi chú.");
                    }
                }
            }
            
            async function handleStatusChange(e) {
                const id = e.currentTarget.dataset.id;
                const docToUpdate = documents.find(d => d.id === id);
                if (docToUpdate) {
                    let updatedData = {};
                    if (docToUpdate.status === 'pending' && docToUpdate.recurringType && docToUpdate.recurringType !== 'none') {
                        // Xử lý công việc lặp lại
                        const currentDueDate = new Date(docToUpdate.dueDate);
                        let nextDueDate;
                        switch (docToUpdate.recurringType) {
                            case 'daily': nextDueDate = new Date(currentDueDate.setDate(currentDueDate.getDate() + 1)); break;
                            case 'weekly': nextDueDate = new Date(currentDueDate.setDate(currentDueDate.getDate() + 7)); break;
                            case 'monthly': nextDueDate = new Date(currentDueDate.setMonth(currentDueDate.getMonth() + 1)); break;
                        }
                        updatedData.dueDate = nextDueDate ? nextDueDate.toISOString().slice(0, 10) : docToUpdate.dueDate;
                        if (!nextDueDate) updatedData.status = 'completed';
                    } else {
                        updatedData.status = docToUpdate.status === 'completed' ? 'pending' : 'completed';
                    }
                    
                    try {
                        const docRef = doc(db, "documents", id);
                        await setDoc(docRef, updatedData, { merge: true });
                        Object.assign(docToUpdate, updatedData); // Cập nhật local data
                        renderAll();
                    } catch (error) {
                        console.error("Lỗi khi cập nhật trạng thái: ", error);
                        alert("Đã xảy ra lỗi khi cập nhật trạng thái.");
                    }
                }
            }

            async function handleDelete(e) {
                const id = e.currentTarget.dataset.id;
                if (confirm('Đồng chí có chắc chắn muốn xóa công việc này không?')) {
                    try {
                        await deleteDoc(doc(db, "documents", id));
                        documents = documents.filter(doc => doc.id !== id);
                        renderAll();
                    } catch (error) {
                        console.error("Lỗi khi xóa: ", error);
                        alert("Đã xảy ra lỗi khi xóa công việc.");
                    }
                }
            }

            function setSort(column) {
                sortBy = column;
                sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
                renderDocuments();
            }
            
            function handleExportReport(exportType) {
                let docsToExport;
                let reportTitle;
                switch(exportType) {
                    case 'all': docsToExport = [...documents]; reportTitle = 'BÁO CÁO TOÀN BỘ CÔNG VIỆC'; break;
                    case 'completed': docsToExport = documents.filter(doc => doc.status === 'completed'); reportTitle = 'BÁO CÁO CÔNG VIỆC ĐÃ HOÀN THÀNH'; break;
                    case 'pending': docsToExport = documents.filter(doc => doc.status === 'pending' && calculateDaysRemaining(doc.dueDate) >= 0); reportTitle = 'BÁO CÁO CÔNG VIỆC ĐANG XỬ LÝ'; break;
                    case 'overdue': docsToExport = documents.filter(doc => doc.status === 'pending' && calculateDaysRemaining(doc.dueDate) < 0); reportTitle = 'BÁO CÁO CÔNG VIỆC TRỄ HẠN'; break;
                    default: return;
                }
                docsToExport.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                const reportDate = new Date().toLocaleDateString('vi-VN');
                let reportHtml = `<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><title>${reportTitle}</title><style>body{font-family:'Times New Roman',serif;font-size:13pt;margin:2cm}h1,h2{text-align:center;margin:0;font-weight:bold}h1{font-size:14pt}h2{font-size:16pt;margin-bottom:20px}table{width:100%;border-collapse:collapse;margin-top:15px}th,td{border:1px solid black;padding:8px;text-align:left;vertical-align:top}th{font-weight:bold;text-align:center}.no-print{margin-top:30px;text-align:center}@media print{.no-print{display:none}}</style></head><body><h1>UBND XÃ ĐỨC LẬP</h1><hr style="width:50%;border:1px solid black"><h2>${reportTitle}<br><span style="font-weight:normal;font-size:12pt">(Tính đến ngày ${reportDate})</span></h2><table><thead><tr><th>STT</th><th>Nội dung / Trích yếu</th><th>Chuyên viên</th><th>Mức độ</th><th>Hạn xử lý</th><th>Ghi chú</th></tr></thead><tbody>`;
                if (docsToExport.length === 0) {
                    reportHtml += '<tr><td colspan="6" style="text-align:center;">Không có công việc nào.</td></tr>';
                } else {
                    docsToExport.forEach((doc, index) => {
                        reportHtml += `<tr><td style="text-align:center">${index + 1}</td><td>${doc.title}</td><td>${doc.chuyenVien || '-'}</td><td style="text-align:center">${doc.priority || 'Thường'}</td><td style="text-align:center">${new Date(doc.dueDate).toLocaleDateString('vi-VN')}</td><td>${doc.notes || ''}</td></tr>`;
                    });
                }
                reportHtml += `</tbody></table><div class="no-print"><button onclick="window.print()">In Báo cáo</button></div></body></html>`;
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(reportHtml);
                reportWindow.document.close();
                closeExportModal();
            }

            /**
             * [HÀM TỐI ƯU HÓA] Gửi yêu cầu đến Google Gemini API, hỗ trợ cả văn bản và tệp tin.
             */
                const prompt = `Bạn là một trợ lý hành chính công xuất sắc tại Việt Nam. Phân tích văn bản và trả về kết quả JSON. Luôn trả lời bằng tiếng Việt.
Yêu cầu:
1.  **Phân loại Mức độ Quan trọng**: "Khẩn cấp", "Quan trọng", hoặc "Thường".
2.  **Phân công nhiệm vụ**: Dựa vào nội dung, hãy chọn ra **MỘT (01) lãnh đạo**, **MỘT (01)** trưởng/phó phòng, và **MỘT (01)** chuyên viên xử lý chính phù hợp nhất. **Việc phân công là bắt buộc; hãy đưa ra lựa chọn hợp lý nhất ngay cả khi thông tin không hoàn toàn rõ ràng.** **Tuyệt đối không trả về một danh sách nhiều người cho một vai trò**. Ghi rõ họ tên và chức vụ trong ngoặc đơn.
    * **Lãnh đạo UBND**: 1. Nguyễn Hữu Phố (Chủ tịch): a) Lãnh đạo, chỉ đạo, điều hành và quản lý toàn diện về mọi hoạt động thuộc chức năng, nhiệm vụ, quyền hạn của UBND xã theo quy định của pháp luật. b) Theo dõi, chỉ đạo: Công an xã, Ban Chỉ huy Quân sự xã và các phòng chuyên môn (về lĩnh vực phụ trách). c) Chỉ đạo, điều hành các lĩnh vực công tác sau:
Công tác quy hoạch, kế hoạch hàng năm và 05 năm của xã trình cấp có thẩm quyền xem xét quyết định; tổ chức thực hiện nghị quyết của HĐND cùng cấp; kế hoạch phát triển kinh tế - xã hội của xã; giao đất, cho thuê đất.
Kế hoạch đầu tư, xây dựng cơ bản; phê duyệt chủ trương đầu tư, kế hoạch lựa chọn nhà thầu về các công trình, dự án lĩnh vực kinh tế, xã hội, quốc phòng, an ninh; phụ trách chung về xúc tiến đầu tư, thu hút đầu tư trên địa bàn xã.
Quyết định phân bổ, giao dự toán chi đối với các khoản chưa phân bổ chi tiết; quyết định điều chỉnh dự toán ngân sách cấp mình và các nội dung khác ngân sách của địa phương; quản lý, sử dụng có hiệu quả nguồn vốn đầu tư, tài chính, nguồn ngân sách.
Công tác quân sự - quốc phòng và an ninh - trật tự; đối ngoại; công tác phòng chống tham nhũng, tiêu cực và thực hành tiết kiệm, chống lãng phí.
Công tác xây dựng chính quyền, địa giới hành chính; tổ chức bộ máy, công tác cán bộ; công tác thi đua khen thưởng và kỷ luật.
Những vấn đề lớn, quan trọng liên quan đến hoạt động của UBND xã trên tất cả các lĩnh vực mà Chủ tịch thấy cần trực tiếp chỉ đạo, điều hành. d) Tiếp công dân và giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh theo lĩnh vực phụ trách và quy định của pháp luật. đ) Giữ mối quan hệ làm việc với UBND tỉnh, Chủ tịch UBND tỉnh, các cơ quan cấp tỉnh, Thường trực Đảng ủy, Thường trực HĐND, Thường trực UBMTTQ xã và đơn vị ngành dọc đóng trên địa bàn và tổ chức, cá nhân có liên quan. e) Làm nhiệm vụ: Trưởng các ban chỉ đạo và chủ tịch hội đồng về một số lĩnh vực theo quy định của pháp luật Chủ tịch UBND xã là trưởng ban và chủ tịch. g) Phụ trách địa bàn cộng đồng dân cư theo phụ lục đính kèm.
2. Nguyễn Văn Tuấn (P. Chủ tịch):a) Chỉ đạo, điều hành hoạt động chung của UBND xã khi Chủ tịch vắng mặt hoặc khi được Chủ tịch ủy quyền. b) Theo dõi, chỉ đạo hoạt động của các đơn vị: Phòng Kinh tế; Trung tâm phục vụ hành chính công xã. c) Thay mặt Chủ tịch theo dõi, chỉ đạo các lĩnh vực công tác:
Thuế, phí, lệ phí, thu ngân sách khác; về giá; quản lý tài sản công; các hoạt động dịch vụ tài chính tại địa phương theo quy định của pháp luật.
Kế hoạch xúc tiến đầu tư, Chương trình xúc tiến đầu tư, danh mục dự án thu hút đầu tư tại địa phương; đăng ký kinh doanh; kinh tế tập thể, kinh tế hợp tác xã.
Kế hoạch phát triển kinh tế - xã hội, thống kê chỉ tiêu, số liệu về kinh tế xã hội.
Phát triển đô thị; hạ tầng kỹ thuật đô thị; trật tự xây dựng, nhà ở; công sở; vật liệu xây dựng; giao thông vận tải; tiểu thủ công nghiệp; công nghiệp; chợ, thương mại dịch vụ.
Đất đai; tài nguyên; môi trường; quản lý, phát triển quỹ đất, bồi thường, giải phóng mặt bằng; nông nghiệp; lâm nghiệp; thủy lợi; thủy sản; phát triển nông thôn; phòng, chống thiên tai; chất lượng, an toàn thực phẩm đối với nông sản, lâm sản, thủy sản; phát triển kinh tế hộ, kinh tế trang trại nông thôn, kinh tế tập thể, nông, lâm, ngư nghiệp gắn với ngành nghề, làng nghề nông thôn; giảm nghèo.
Tiếp công dân và chủ trì giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh về lĩnh vực phụ trách. d) Phê duyệt Báo cáo kinh tế - kỹ thuật và Phê duyệt Quyết toán dự án hoàn thành đối với các công trình, dự án thuộc lĩnh vực phụ trách. đ) Làm nhiệm vụ: Trưởng các ban chỉ đạo và chủ tịch hội đồng về lĩnh vực được giao phụ trách (mà theo quy định pháp luật Chủ tịch UBND không nhất thiết làm trưởng ban, chủ tịch hội đồng). Theo dõi, chỉ đạo các Chương trình mục tiêu quốc gia thuộc lĩnh vực phụ trách. e) Chỉ đạo, quản lý, điều hành toàn diện các hoạt động của Trung tâm phục vụ hành chính công và chịu trách nhiệm trước UBND xã, Chủ tịch UBND xã và trước pháp luật về hoạt động Trung tâm phục vụ hành chính công. g) Giúp Chủ tịch UBND xã giữ mối quan hệ làm việc với các cơ quan cấp tỉnh, Đảng ủy, HĐND, UBMTTQ xã, các cơ quan tham mưu, giúp việc của Đảng ủy và cơ quan, đơn vị ngành dọc đóng trên địa bàn (cơ quan thuế, kho bạc, thống kê, ngân hàng, Văn phòng đăng ký đất đai ...), đơn vị có liên quan đến lĩnh vực phụ trách. h) Ký ban hành các văn bản thuộc lĩnh vực được phân công phụ trách (trừ các nội dung do Chủ tịch UBND xã trực tiếp phụ trách); ký văn bản góp ý Dự thảo văn bản do cấp trên gửi lấy ý kiến theo lĩnh vực phụ trách. i) Phụ trách địa bàn cộng đồng dân cư theo phụ lục đính kèm và thực hiện các nhiệm vụ khác khi được Chủ tịch UBND xã giao hoặc uỷ quyền.
Điều hành, phụ trách chung chịu trách nhiệm trước UBND xã, Chủ tịch UBND xã, trước pháp luật về toàn bộ hoạt động của Trung tâm; trực tiếp chỉ đạo các nhiệm vụ trọng tâm đột xuất, quan trọng của Trung tâm Phục vụ hành chính công xã;
Phân công nhiệm vụ công chức chuyên môn làm việc tại Trung tâm Phục vụ hành chính công xã, đảm bảo duy trì tốt lịch tiếp dân và giải quyết công việc theo đúng quy định của pháp luật;
Trực tiếp giải quyết các vướng mắc, kiến nghị của tổ chức, công dân đến giao dịch vượt quá thẩm quyền của Phó Giám đốc;
Là chủ tài khoản của Trung tâm Phục vụ hành chính công xã Đức Lập.
3. Đinh Thanh Hải (P. Chủ tịch): a) Chỉ đạo, điều hành hoạt động chung của UBND xã khi được Chủ tịch UBND xã ủy quyền. b) Theo dõi, chỉ đạo hoạt động của các đơn vị: Phòng Văn hóa - Xã hội; Văn phòng HĐND - UBND xã; Trung tâm văn hóa, thể thao xã. c) Thay mặt Chủ tịch theo dõi, chỉ đạo các lĩnh vực công tác:
Công tác nội vụ, dân tộc, tôn giáo (trừ các nhiệm vụ do Chủ tịch đã phụ trách); hoạt động của tổ chức hội.
Công tác giáo dục và đào tạo.
Khoa học và công nghệ; phối hợp chặt chẽ với đồng chí Phó Chủ tịch, Giám đốc TTPVHCC chỉ đạo ứng dụng công nghệ thông tin; giao dịch điện tử; chính quyền số; kinh tế số, xã hội số và chuyển đổi số; hạ tầng thông tin.
Văn hóa, thể thao, du lịch, bưu chính, viễn thông.
Lao động việc làm, chính sách người có công, an sinh xã hội.
Công tác y tế, dân số, gia đình, trẻ em; bình đẳng giới, vì sự tiến bộ của phụ nữ; phòng chống tội phạm, tai, tệ nạn xã hội.
Công tác cải cách hành chính, đổi mới sáng tạo gắn với chuyển đổi số.
Các hoạt động tham mưu, giúp việc về công tác văn phòng và công tác quản trị nội bộ của Văn phòng HĐND & UBND xã.
Nhiệm vụ thuộc lĩnh vực công tác tư pháp (Công tác xây dựng và tổ chức thi hành pháp luật, theo dõi việc thi hành, kiểm tra, xử lý văn bản quy phạm pháp luật, phổ biến, giáo dục pháp luật; hòa giải, trợ giúp pháp lý, nuôi con nuôi, hộ tịch, chứng thực, xử lý vi phạm hành chính ...). d) Tiếp công dân và giải quyết đơn thư khiếu nại, tố cáo, kiến nghị phản ánh thuộc lĩnh vực phụ trách. đ) Phê duyệt Báo cáo kinh tế - kỹ thuật và Phê duyệt Quyết toán dự án hoàn thành đối với các công trình, dự án thuộc lĩnh vực phụ trách. e) Làm nhiệm vụ: Trưởng các ban chỉ đạo và chủ tịch hội đồng về lĩnh vực được giao phụ trách (mà theo quy định pháp luật Chủ tịch UBND không nhất thiết làm trưởng ban, chủ tịch hội đồng). Theo dõi, chỉ đạo các Chương trình mục tiêu quốc gia thuộc lĩnh vực phụ trách. g) Giúp Chủ tịch UBND xã giữ mối quan hệ làm việc với các cơ quan cấp tỉnh, Đảng ủy, UBMTTQ xã, các cơ quan tham mưu, giúp việc của Đảng ủy, đơn vị ngành dọc đóng trên địa bàn (Viện kiểm sát, tòa án, thi hành án, trung tâm y tế, cơ sở giáo dục, bảo hiểm xã hội, ngân hàng chính sách,...) và cơ quan, đơn vị có liên quan đến lĩnh vực phụ trách. h) Xem xét, ký ban hành các văn bản thuộc lĩnh vực được phân công phụ trách (trừ các nội dung do Chủ tịch UBND xã trực tiếp phụ trách); ký văn bản góp ý Dự thảo văn bản do cấp trên gửi lấy ý kiến theo lĩnh vực phụ trách; ký các quyết định nâng lương định kỳ, trước hạn, vượt khung, thâm niên, phụ cấp thâm niên nghề đối với ngành giáo dục thuộc xã. i) Phụ trách địa bàn cộng đồng dân cư theo phụ lục đính kèm và thực hiện các nhiệm vụ khác khi được Chủ tịch UBND xã giao hoặc uỷ quyền.
* **Phòng Văn hóa – Xã hội (VHXH)**:
4. Ông Phạm Khắc Chung – Trưởng Phòng
Phụ trách chung các công việc chuyên môn của phòng; trực tiếp chỉ đạo công tác quản lý Nhà nước về các lĩnh vực:
Các lĩnh vực Nội vụ: Tổ chức hành chính, sự nghiệp nhà nước; chính quyền địa phương, địa giới đơn vị hành chính; cán bộ, chuyên viên, viên chức và công vụ; cải cách hành chính; thi đua khen thưởng; kỷ luật.
Các lĩnh vực Giáo dục và Đào tạo, gồm: Giáo dục mầm non, giáo dục phổ thông (giáo dục tiểu học và trung học cơ sở).
Quản lý và chịu trách nhiệm về tài chính, tài sản của Phòng theo quy định của pháp luật.
5. Bà Nguyễn Thị Phương – Phó Trưởng Phòng
Tham mưu giúp trưởng phòng chỉ đạo, điều hành mọi hoạt động của cơ quan khi trưởng phòng đi vắng hoặc khi được trưởng phòng ủy quyền; trực tiếp tham mưu, lãnh đạo thực hiện công tác quản lý Nhà nước về một số mặt công tác:
Các lĩnh vực Nội vụ: Hội, tổ chức phi chính phủ; văn thư, lưu trữ nhà nước; thanh niên; lao động, tiền lương; việc làm; bảo hiểm xã hội; an toàn, vệ sinh lao động; người có công; bình đẳng giới; công tác dân tộc và tín ngưỡng, tôn giáo.
Các lĩnh vực Văn hóa, Khoa học và Thông tin, gồm: Văn hóa; gia đình; thể dục, thể thao; du lịch; quảng cáo; phát thanh truyền hình; báo chí; thông tin cơ sở; thông tin đối ngoại; hoạt động nghiên cứu khoa học, phát triển công nghệ, đổi mới sáng tạo, phát triển tiềm lực khoa học và công nghệ; sở hữu trí tuệ; tiêu chuẩn đo lường chất lượng; ứng dụng bức xạ và đồng vị phóng xạ; an toàn bức xạ và hạt nhân; bưu chính; ứng dụng công nghệ thông tin (không bao gồm an toàn thông tin, an ninh mạng); giao dịch điện tử; chính quyền số; kinh tế số, xã hội số và chuyển đổi số; hạ tầng thông tin.
Các lĩnh vực Y tế: Y tế dự phòng; khám bệnh, chữa bệnh, phục hồi chức năng; bà mẹ, trẻ em; dân số; phòng, chống tệ nạn xã hội (không bao gồm cai nghiện ma túy và quản lý sau cai nghiện ma túy); bảo trợ xã hội; y dược cổ truyền; dược; mỹ phẩm; an toàn thực phẩm; thiết bị y tế; bảo hiểm y tế.
6. Ông Trần Quốc Hoàn - Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực Nội vụ: Chính quyền địa phương, địa giới đơn vị hành chính; an toàn, vệ sinh lao động.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
7. Ông Huỳnh Quốc Toàn - Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực Nội vụ: Tổ chức bộ máy (tổ chức hành chính và đơn vị sự nghiệp); cán bộ, chuyên viên, viên chức sự nghiệp (không bao gồm sự nghiệp giáo dục), NHĐKCT và công vụ; các lĩnh vực Văn hoá, Khoa học và Thông tin: giao dịch điện tử; chính quyền số; kinh tế số, xã hội số và chuyển đổi số; hạ tầng thông tin.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
8. Bà Hoàng Thị Thu Bắc – Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực Nội vụ: Công tác thi đua khen thưởng; lao động, tiền lương; việc làm.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
Báo cáo tổng hợp của Phòng theo tuần, tháng, quý, năm và đột xuất.
9. Bà Trần Thị Hồng Hạnh - Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực Nội vụ: Cải cách hành chính; kỷ luật; thanh niên, bình đẳng giới; tổ chức hội, tổ chức phi chính phủ; dân chủ, dân vận chính quyền.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
10. Bà Sào Thị Lưu – Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực Nội vụ: Công tác dân tộc và tín ngưỡng, tôn giáo; người có công.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
11. Bà Đặng Thị Tin - Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực GDĐT: Giáo dục mầm non, đầu mối phổ cập giáo dục và xoá mù chữ; Nội vụ: tổ chức bộ máy, quản lý viên chức các trường học mầm non trực thuộc UBND xã.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
12. Ông Trần Văn Trọng – Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực GDĐT: Giáo dục phổ thông, đầu mối đánh giá kiểm định chất lượng giáo dục và đánh giá công nhận Trường đạt chuẩn quốc gia; Nội vụ: tổ chức bộ máy, quản lý viên chức các trường học GDPT trực thuộc UBND xã.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
13. Bà Nguyễn Thị Vân - Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực Văn hóa, Khoa học và Thông tin: Văn hóa; gia đình; thể dục, thể thao; du lịch; quảng cáo; phát thanh truyền hình; báo chí; thông tin cơ sở; thông tin đối ngoại; bưu chính; Nội vụ: Đào tạo, bồi dưỡng.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
14. Bà Ngô Thị Thuý - Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực Văn hóa, Khoa học và Thông tin: Hoạt động nghiên cứu khoa học, phát triển công nghệ, đổi mới sáng tạo, phát triển tiềm lực khoa học và công nghệ; sở hữu trí tuệ; tiêu chuẩn đo lường chất lượng; ứng dụng bức xạ và đồng vị phóng xạ; an toàn bức xạ và hạt nhân; ứng dụng công nghệ thông tin (không bao gồm an toàn thông tin, an ninh mạng); Nội vụ: Văn thư, lưu trữ nhà nước.
Thực hiện nhiệm vụ Văn thư, Thủ quỹ của đơn vị.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
15. Bà Phạm Nữ Mỹ Duyên - Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện lĩnh vực Y tế: Bảo trợ xã hội; trợ cấp hưu trí; bảo hiểm y tế.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
16. Bà Nguyễn Thị Kim Oanh - Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực lĩnh vực Y tế: Y tế dự phòng; khám bệnh, chữa bệnh, phục hồi chức năng; bà mẹ, trẻ em; dân số; phòng, chống tệ nạn xã hội (không bao gồm cai nghiện ma túy và quản lý sau cai nghiện ma túy); y dược cổ truyền; dược; mỹ phẩm; an toàn thực phẩm; thiết bị y tế.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
17. Bà Đào Thị Trường Giang – Chuyên viên
Trực tiếp tham mưu, theo dõi, kiểm tra, đôn đốc giúp lãnh đạo Phòng thực hiện các lĩnh vực: Kế toán; bảo hiểm xã hội; chế độ tiền lương và chế độ, chính sách liên quan CBCCVC, NHĐKCT cấp xã.
Thực hiện công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao.
Tham mưu giải quyết đơn thư, khiếu nại tố cáo lĩnh vực liên quan.
* **Phòng Kinh tế (KT)**:
18. Trưởng phòng: Ông Văn Minh Diệu 
a. Phụ trách chung, chỉ đạo và điều hành mọi hoạt động của đơn vị. 
b. Trực tiếp chỉ đạo các lĩnh vực:
Công tác tổ chức cán bộ; công tác quản lý tài chính; công tác thi đua khen thưởng, kỷ luật; công tác phòng chống tham nhũng, thực hành tiết kiệm, chống lãng phí; công tác tiếp công dân.
Lĩnh vực Xây dựng và Công thương, gồm: Thẩm định báo cáo nghiên cứu khả thi đầu tư xây dựng, thiết kế triển khai sau thiết kế cơ sở của dự án đầu tư xây dựng, kiểm tra công tác nghiệm thu công trình xây dựng trên địa bàn xã khi được giao; Quy hoạch xây dựng, kiến trúc; hoạt động đầu tư xây dựng; phát triển đô thị; hạ tầng kỹ thuật đô thị (bao gồm: cấp nước, thoát nước đô thị; cơ sở sản xuất vật liệu xây dựng; chiếu sáng đô thị, cây xanh đô thị; quản lý nghĩa trang, trừ nghĩa trang liệt sĩ; quản lý xây dựng ngầm đô thị; quản lý sử dụng chung cơ sở hạ tầng kỹ thuật đô thị); nhà ở; công sở; vật liệu xây dựng: giao thông; tiểu thủ công nghiệp; công nghiệp; thương mại.
Về lĩnh vực đất đai gồm: Công tác đo đạc, lập bản đồ địa chính, xây dựng cơ sở dữ liệu đất đai; đăng ký đất đai; lập, quản lý, chỉnh lý hồ sơ địa chính; cấp giấy chứng nhận quyền sử dụng đất, chuyển mục đích sử dụng đất, giao đất, cho thuê đất; thống kê, kiểm kê đất đai; Quy hoạch, kế hoạch sử dụng đất. Công tác thẩm định phương án bồi thường, hỗ trợ tái định cư; công tác xây dựng giá các loại đất; công tác đấu giá quyền sử dụng sử dụng đất.
Công tác quản lý tài sản công; quỹ đất công.
Công tác về trồng trọt và bảo vệ thực vật; chăn nuôi thú y; về lâm nghiệp.
Về tài nguyên nước; địa chất, khoáng sản; môi trường; bảo tồn thiên nhiên thuỷ sản; thuỷ lợi; đê điều và phòng chống thiên tai; và đa dạng sinh học; khí tượng thủy văn.
Chủ trì tổ chức triển khai phát triển kinh tế nông thôn gắn với sản phẩm OCOP và phát triển du lịch nông thôn và cộng đồng dân cư thực hiện nội dung của các chương trình theo quy định.
Về lĩnh vực Giao thông Vận tải: Tổ chức quản lý, bảo trì, bảo đảm tiêu chuẩn, quy chuẩn kỹ thuật mạng lưới công trình giao thông đường bộ, địa phương đang khai thác do xã chịu trách nhiệm quản lý.
Công tác tuyên truyền pháp luật; thanh tra, kiểm tra việc thi hành pháp luật về lĩnh vực phân công.
Công tác giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách. Công tác cải cách hành chính; quản lý hệ thống quản lý chất lượng ISO tại đơn vị; Chương trình chuyển đổi số Phòng Kinh tế.
Tham gia các Ban chỉ đạo, Hội đồng của UBND xã theo lĩnh vực được phân công.
19. Phó Trưởng phòng: Bà Phạm Thị Hồng 
a. Thay mặt Trưởng phòng chỉ đạo, điều hành một số hoạt động của đơn vị được Trưởng phòng ủy quyền khi vắng mặt. 
b. Trực tiếp theo dõi, chỉ đạo, điều hành, quản lý các lĩnh vực:
Lĩnh vực Tài chính – Kế hoạch, gồm: Tài chính – ngân sách nhà nước; kế hoạch và đầu tư, thống kê; đăng ký hộ kinh doanh, tổ hợp tác, liên hợp tác xã; hỗ trợ doanh nghiệp, tổ chức kinh tế tập thể.
Tổ chức thực hiện các văn bản pháp luật, quy hoạch, kế hoạch sau khi được phê duyệt; thông tin, tuyên truyền, phổ biến, giáo dục pháp luật và theo dõi thi hành pháp luật trong lĩnh vực Tài chính - Kế hoạch trên địa bàn.
Hướng dẫn các cơ quan, đơn vị dự toán thuộc xã xây dựng dự toán ngân sách hằng năm, tổng hợp trình Ủy ban nhân dân cấp xã theo quy định.
Tổng hợp, lập dự toán ngân sách cấp xã, phương án phân bổ ngân sách cấp xã, dự toán điều chỉnh ngân sách cấp xã trong trường hợp cần thiết trình Ủy ban nhân dân cấp xã; tổ chức thực hiện dự toán ngân sách đã được quyết định.
Cấp phát, thanh toán, thẩm định quyết toán kinh phí cho các đơn vị, tổ chức, cá nhân; tổng hợp quyết toán theo quy định của pháp luật về ngân sách nhà nước.
Lập, thẩm định, tổng hợp kế hoạch đầu tư công trong phạm vi nhiệm vụ được giao và nguồn vốn thuộc Ủy ban nhân dân cấp xã quản lý; tổng hợp tham mưu gia hạn thời gian bố trí vốn, kéo dài thời gian thực hiện và giải ngân vốn thuộc phân cấp quản lý.
Về lĩnh vực công thương: Hướng dẫn và thực hiện chính sách khuyến khích các tổ chức kinh tế tập thể, kinh tế tư nhân đầu tư phát triển công nghiệp, mở rộng sản xuất - kinh doanh; tổ chức các hoạt động dịch vụ tư vấn chuyển giao công nghệ, cung cấp thông tin, xúc tiến thương mại. Thực hiện các chương trình, kế hoạch xúc tiến thương mại, xây dựng và phát triển thương hiệu trên địa bàn xã theo phân công của các cấp có thẩm quyền.
Chương trình Mục tiêu quốc gia xây dựng nông thôn mới và Chương trình khai, theo dõi, tổng hợp, báo cáo kết quả thực hiện; phối hợp với các tổ chức, đoàn thể Mục tiêu quốc gia giảm nghèo bền vững trên địa bàn cấp xã.
Về lĩnh vực khoa học và công nghệ: Quản lý, triển khai thực hiện các nhiệm vụ khoa học và công nghệ sử dụng ngân sách nhà nước; tổ chức nghiên cứu ứng dụng tiến bộ khoa học, công nghệ; phát triển phong trào lao động sáng tạo; phổ biến, lựa chọn các kết quả nghiên cứu khoa học và phát triển công nghệ, các sáng chế, sáng kiến, cải tiến kỹ thuật, hợp lý hóa sản xuất để áp dụng tại địa phương; tổ chức thực hiện các dịch vụ khoa học và công nghệ trên địa bàn xã. Về tiêu chuẩn, đo lường và chất lượng sản phẩm, hàng hóa; kiểm tra đo lường chất lượng sản phẩm và hàng hóa trên địa bàn xã; Quản lý, khuyến khích, hỗ trợ phát triển hợp tác xã, kinh tế tập thể, kinh tế tư nhân về khoa học và công nghệ trên địa bàn xã.
Lĩnh vực công thương: Thẩm định, đăng ký, cấp các loại giấy đăng ký thành lập hộ kinh doanh và các nhiệm vụ liên quan đến lĩnh vực công thương.
Lĩnh vực đất đai: Phối hợp Công tác thẩm định phương án bồi thường, hỗ trợ tái định cư; công tác xây dựng giá các loại đất; công tác đấu giá quyền sử dụng sử dụng đất.
Công tác quản lý tài sản công; quỹ đất công.
Công tác tuyên truyền pháp luật; thanh tra, kiểm tra việc thi hành pháp luật về lĩnh vực phân công.
Tham gia các Ban chỉ đạo, Hội đồng của UBND xã theo lĩnh vực được phân công.
Công tác giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách.
Thực hiện một số nhiệm vụ khác theo sự phân công hoặc uỷ quyền của Trưởng phòng.
20. Ông Trần Văn Long - Chuyên viên. Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Phụ trách, tham mưu về lĩnh vực quản lý nhà nước về nghĩa trang (trừ nghĩa trang liệt sỹ).
Tham mưu cho lãnh đạo thực hiện nhiệm vụ chuyên môn liên quan đến tiêu chí, chỉ tiêu xây dựng nông thôn mới tiêu chí nghĩa trang, cơ sở hỏa táng, điện.
Phối hợp tham gia quản lý trật tự xây dựng trên địa bàn xã.
Tham mưu, giám sát công tác quản lý chợ, trung tâm thương mại của các Ban quản lý, Tổ quản lý, doanh nghiệp quản lý chợ trên địa bàn xã.
Tham mưu về quản lý điện, an toàn điện, đầu tư hạ tầng điện và các đơn vị kinh doanh dịch vụ điện.
Tham mưu quản lý hạ tầng công trình hồ đập, công trình thủy điện và các công trình khác thuộc trách nhiệm của phòng.
Tham mưu giải quyết các đơn thư khiếu nại, tố cáo các lĩnh vực thuộc chuyên môn của đơn vị.
Theo dõi, quản lý các hoạt động vận tải hành khách, hàng hóa trên địa bàn xã theo phân cấp.
Báo cáo định kỳ, đột xuất các lĩnh vực được phân công.
21. Bà Võ Thị Hà Phương - Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Thẩm định hồ sơ đề nghị cấp, gia hạn, điều chỉnh, thu hồi giấy phép xây dựng công trình khu vực địa bàn thị trấn Đắk Mil (cũ), kiểm tra sau cấp phép.
Trình UBND xã các quyết định, chỉ thị, quy hoạch phát triển, kế hoạch dài hạn, 5 năm và hàng năm; các chương trình, dự án đầu tư xây dựng trong các lĩnh vực quản lý nhà nước thuộc ngành xây dựng trên địa bàn xã.
Lập, thẩm định, trình UBND xã phê duyệt hoặc dự thảo của UBND xã trình cấp có thẩm quyền thẩm định, phê duyệt các đồ án quy hoạch xây dựng xã.
Lập, thẩm định, trình UBND xã phê duyệt hoặc dự thảo của UBND xã trình cấp có thẩm quyền thẩm định, phê duyệt các đồ án quy hoạch xây dựng chung, quy hoạch chi tiết theo thẩm quyền được phân cấp.
Thẩm định hồ sơ đề nghị cấp, gia hạn, điều chỉnh, thu hồi giấy phép xây dựng đối với các dự án, công trình do tổ chức thực hiện.
Lập kế hoạch đầu tư xây dựng các công trình do Phòng làm chủ đầu tư.
Thẩm định Báo cáo kinh tế - kỹ thuật, Thiết kế bản vẽ thi công - dự toán công trình giao thông, cầu đường theo phân cấp,...;
Kiểm tra công tác nghiệm thu công trình.
Xây dựng kế hoạch và kiểm tra chất lượng công trình xây dựng theo quy định.
Báo cáo các lĩnh vực phụ trách theo quy định.
Tham mưu cho lãnh đạo thực hiện nhiệm vụ chuyên môn liên quan đến tiêu chí, chỉ tiêu xây dựng nông thôn mới về lĩnh vực quy hoạch.
Tham mưu cho lãnh đạo thực hiện nhiệm vụ chuyên môn liên quan đến tiêu chí, chỉ tiêu xây dựng nông thôn mới tiêu chí Nhà ở dân cư.
22. Bà Trần Thị Quỳnh Trang – Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Tham mưu trình UBND xã dự thảo các quyết định, chỉ thị, quy hoạch, kế hoạch dài hạn, 5 năm và hàng năm, chương trình phát triển giao thông vận tải; chương trình, giải pháp huy động, phối hợp liên ngành trong công tác đảm bảo trật tự, an toàn giao thông trên địa bàn xã; Tham gia giải tỏa, quản lý hành lang an toàn giao thông các tuyến đường Quốc lộ, Tỉnh lộ, các đường liên xã và các tuyến đường giao thông trên địa bàn xã.
Tham mưu Quyết định thành lập Đoàn kiểm tra liên ngành, xây dựng Kế hoạch và chủ trì, phối hợp các cơ quan liên quan kiểm tra An toàn giao thông trên địa bàn xã.
Kiêm nhiệm công tác văn thư, lưu trữ; thủ quỹ.
Tổng hợp báo cáo tuần, tháng, quý, năm của đơn vị và báo cáo các lĩnh vực chuyên môn theo quy định.
Thẩm định hồ sơ đề nghị cấp, gia hạn, điều chỉnh, thu hồi giấy phép xây dựng công trình đối với địa phận xã Đức Minh, xã Đức Mạnh (cũ), kiểm tra sau cấp phép.
Thẩm định hồ sơ đề nghị cấp, gia hạn, điều chỉnh, thu hồi giấy phép xây dựng đối với các dự án, công trình do tổ chức thực hiện.
Tham mưu phụ trách công tác giao thông vận tải.
Phối hợp với Tòa án, Chi cục Thi hành án dân sự và các cơ quan liên quan xác minh tài sản theo quy định.
Tham mưu phụ trách công tác trợ giúp Ban an toàn giao thông của xã; báo cáo công tác an toàn giao thông hàng tháng, quý, năm và đột xuất.
Đầu mối tham mưu cho lãnh đạo thực hiện nhiệm vụ chuyên môn liên quan đến tiêu chí nông thôn mới, trực tiếp thực hiện tiêu tiêu chí Giao thông.
23. Bà Nguyễn Thị Lài – Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Chủ trì tổng hợp phối hợp các bộ phận liên quan thuộc Phòng tham mưu xây dựng chương trình, kế hoạch dài hạn, trung hạn, hằng năm về tài chính, ngân sách phù hợp với quy hoạch, kế hoạch tổng thể phát triển kinh tế xã hội của địa phương.
Là đầu mối tổng hợp, lập dự toán thu ngân sách nhà nước đối với những khoản thu được phân cấp quản lý, dự toán chi ngân sách xã; lập dự toán ngân sách điều chỉnh trong trường hợp cần thiết để trình Ủy ban nhân dân xã; tổ chức thực hiện dự toán ngân sách đã được quyết định (Tham mưu phân bổ kinh phí, theo dõi, tổng hợp nguồn kinh phí bổ sung trong năm; Tham mưu thu hồi, nộp trả kinh phí còn tồn, không còn nhiệm vụ chi thuộc lĩnh vực được phân công).
Thực hiện tham mưu báo cáo thuộc lĩnh vực ngân sách khi được lãnh đạo giao; báo cáo thu - chi ngân sách theo quy định.
Hướng dẫn các cơ quan, đơn vị dự toán thuộc xã, xây dựng dự toán ngân sách hằng năm, tổng hợp trình Ủy ban nhân dân xã theo quy định.
Phối hợp với cơ quan có liên quan trong việc quản lý công tác thu ngân sách nhà nước trên địa bàn theo quy định của pháp luật.
Cấp phát, thanh toán, thẩm định quyết toán kinh phí cho các đơn vị, tổ chức, cá nhân theo quy định của pháp luật về ngân sách nhà nước.
Lập quyết toán thu, chi ngân sách xã; tổng hợp, lập báo cáo quyết toán thu ngân sách nhà nước trên địa bàn xã và quyết toán thu, chi ngân sách xã; báo cáo Ủy ban nhân dân xã để trình cơ quan có thẩm quyền phê chuẩn.
Là đầu mối phối hợp với các cơ quan, đơn vị có liên quan kiểm tra việc chấp hành pháp luật tài chính - ngân sách; tham mưu Ủy ban nhân dân xã giải quyết các tranh chấp, khiếu nại, tố cáo về lĩnh vực tài chính - ngân sách theo quy định của pháp luật.
Phối hợp cùng với Phòng Giao dịch số 7 - Kho bạc Nhà nước Khu vực XVI kiểm tra, đối chiếu số liệu. Theo dõi, tình hình cấp phát ngân sách hàng tháng (tồn quỹ ngân sách xã).
Chịu trách nhiệm trước Trưởng phòng, UBND xã và trước Pháp luật về kết quả tổng hợp dự toán, phân bổ dự toán.
Tham mưu các văn bản hướng dẫn và thực hiện các báo cáo về lĩnh vực ngân sách nhà nước được giao; Công tác công khai tài chính NSNN theo quy định.
Xử lý các kiến nghị, tham mưu báo cáo liên quan đến thanh tra, kiểm toán.
Mở tài khoản để theo dõi, nhập vào hệ thống Tabmis thuộc lĩnh vực phụ trách.
Là thành viên của các Ban, hội đồng liên quan lĩnh vực được giao (nếu có).
Tham mưu giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách.
Thực hiện báo cáo các lĩnh vực được giao tham mưu theo quy định.
24. Ông Ngô Hoàng Hiệp - Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Tham mưu công tác giám sát, đánh giá đầu tư và báo cáo định kỳ theo quy định. Tham mưu kế hoạch đầu tư công hằng năm, kế hoạch đầu tư công trung hạn và dài hạn.
Tham mưu, theo dõi nợ đọng vốn đầu tư, tiến độ giải ngân và triển khai các nhiệm vụ thuộc lĩnh vực Kế hoạch - Đầu tư, kịp thời tham mưu xử lý các vướng mắc khó khăn, chậm tiến độ.
Là đầu mối tổng hợp, báo cáo, theo dõi, triển khai các nhiệm vụ thuộc lĩnh vực Kế hoạch - Đầu tư.
Tham mưu công tác rà soát và lập danh mục dự án chủ trương đầu tư nguồn NSNN; là thành viên Hội đồng thẩm định chủ trương đầu tư đối với các nhiệm vụ do xã quyết định đầu tư (nếu có).
Thẩm định các nội dung lựa chọn nhà thầu dự án, nhiệm vụ khi lãnh đạo phòng phân công.
Thẩm tra quyết toán dự án hoàn thành; thẩm định các nội dung lựa chọn nhà thầu dự án, nhiệm vụ do lãnh đạo phòng phân công.
Tham mưu công tác công khai, báo cáo trong lĩnh vực đầu tư, đầu tư xây dựng cơ bản theo quy định.
Lập báo cáo tổng hợp quyết toán dự án hoàn thành theo quy định; Quyết toán vốn đầu tư theo niên độ.
Thẩm tra quyết toán dự án hoàn thành; thẩm định các nội dung lựa chọn nhà thầu dự án, nhiệm vụ khi lãnh đạo phòng phân công.
Tham mưu giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách.
Mở tài khoản để theo dõi, nhập vào hệ thống Tabmis thuộc lĩnh vực phụ trách.
Là thành viên của các Ban, hội đồng liên quan lĩnh vực được giao (nếu có).
Tổng hợp số liệu chuẩn bị họp và ghi chép biên bản các cuộc họp của đơn vị.
Thực hiện báo cáo các lĩnh vực được giao tham mưu theo quy định.
25. Ông Võ Sỹ Ngọc Hoàng - Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Là đầu mối về doanh nghiệp, kinh tế tập thể, hợp tác xã, hộ kinh doanh, kinh tế tư nhân; Tiếp nhận hồ sơ đăng ký hợp tác xã, hộ kinh doanh; cấp hoặc từ chối cấp đăng ký hợp tác xã, hộ kinh doanh; hướng dẫn hợp tác xã, hộ kinh doanh và người thành lập hợp tác xã, hộ kinh doanh về hồ sơ, trình tự, thủ tục đăng ký hợp tác xã, hộ kinh doanh.
Hướng dẫn và thực hiện chính sách khuyến khích các tổ chức kinh tế tập thể, kinh tế tư nhân đầu tư phát triển công nghiệp, mở rộng sản xuất kinh doanh; tổ chức các hoạt động dịch vụ tư vấn chuyển giao công nghệ, cung cấp thông tin, xúc tiến thương mại. Thực hiện các chương trình, kế hoạch xúc tiến thương mại, xây dựng và phát triển thương hiệu trên địa bàn xã theo phân công của các cấp có thẩm quyền.
Tham mưu công tác xúc tiến đầu tư; rà soát và lập danh mục thu hút đầu tư; theo dõi và báo cáo các dự án đầu tư ngoài ngân sách trên địa bàn xã.
Hướng dẫn, kiểm tra việc quản lý tài chính, ngân sách, giá, thực hiện chế độ kế toán tài chính hợp tác xã, tài chính kinh tế tập thể và các cơ quan, đơn vị hành chính, sự nghiệp của nhà nước thuộc xã; Công tác khuyến nông, kinh tế tập thể, hợp tác xã lĩnh vực nông lâm nghiệp, kinh tế trang trại.
Tham mưu cho lãnh đạo thực hiện nhiệm vụ chuyên môn liên quan đến tiêu chí, chỉ tiêu xây dựng nông thôn mới: tiêu chí về cơ sở hạ tầng thương mại nông thôn, chợ trung tâm xã đạt tiêu chuẩn chợ kinh doanh thực phẩm, Khu công nghiệp hoặc cụm công nghiệp được đầu tư kết cấu hạ tầng kỹ thuật, nông thôn, hoặc cụm ngành nghề nông thôn.
Tham mưu các nhiệm vụ hỗ trợ phát triển doanh nghiệp nhỏ và vừa trong lĩnh vực công nghiệp, tiểu thủ công nghiệp; thương mại trên địa bàn theo quy định của pháp luật.
Tham mưu công tác Quản lý giá theo quy định của Ủy ban nhân dân tỉnh; kiểm tra việc chấp hành niêm yết giá và bán theo giá niêm yết của các tổ chức, cá nhân kinh doanh hoạt động trên địa bàn; tổ chức thực hiện tiếp nhận kê khai giá theo phân công, phân cấp của Ủy ban nhân dân tỉnh và theo quy định của pháp luật; chủ trì thực hiện thẩm định giá đối với tài sản nhà nước địa phương theo phân cấp của Ủy ban nhân dân tỉnh.
Tham mưu xử phạt vi phạm hành chính trong lĩnh vực Công thương và các nhiệm vụ khác về lĩnh vực Công thương ở địa phương.
Thực hiện quản lý nhà nước về hoá chất, vật liệu nổ công nghiệp, an toàn thực phẩm theo quy định của pháp luật và theo phân công, phân cấp hoặc ủy quyền của cấp có thẩm quyền.
Là thành viên của các Ban, hội đồng liên quan lĩnh vực được giao (nếu có).
Tham mưu giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách.
Phụ trách lĩnh vực cấp giấy chứng nhận đủ điều kiện bán lẻ LPG chai, giấy chứng nhận kinh doanh bán lẻ rượu, giấy chứng nhận kinh doanh bán lẻ sản phẩm thuốc lá theo phân cấp quản lý.
Thực hiện báo cáo các lĩnh vực được giao tham mưu theo quy định.
26. Ông Nguyễn Công Hiếu - Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Tham mưu các nội dung liên quan đến công tác giảm nghèo và Chương trình mục tiêu quốc gia giảm nghèo bền vững, theo dõi tổng hợp, báo cáo kết quả thực hiện.
Là đầu mối tổng hợp, quản lý, phân bổ và quyết toán nguồn vốn thuộc các Chương trình Mục tiêu Quốc gia trên địa bàn xã.
Tham mưu công tác Quản lý Tài sản tịch thu sung quỹ nhà nước, tài sản công tại các cơ quan, tổ chức, đơn vị thuộc xã quản lý theo quy định của Pháp luật về quản lý, sử dụng tài sản công và phân cấp của Hội đồng nhân dân tỉnh. Thẩm định, có ý kiến đối với các nhiệm vụ do cơ quan, người có thẩm quyền thuộc xã xem xét, quyết định theo quy định của pháp luật về quản lý, sử dụng tài sản công; tổ chức thực hiện các quyết định về hình thành, sử dụng, xử lý tài sản công do cơ quan, người có thẩm quyền thuộc xã giao theo quy định của pháp luật về quản lý, sử dụng tài sản công.
Chủ trì, tham mưu cho Ủy ban nhân dân xã thực hiện nhiệm vụ định giá tài sản trong tố tụng hình sự và thực hiện nhiệm vụ thẩm định giá của nhà nước theo quy định của pháp luật.
Tham mưu công tác định giá đất cụ thể khi nhà nước thu hồi đất hoặc bán đấu giá, là thành viên Hội đồng định giá đất cụ thể huyện.
Thẩm định các nội dung lựa chọn nhà thầu dự án, nhiệm vụ khi lãnh đạo phòng phân công.
Tham mưu công tác quản lý giá, thành viên các hội đồng định giá.
Thực hiện tham mưu công tác kế hoạch kinh tế - xã hội và các nhiệm vụ có liên quan.
Trực tiếp chuyên quản về công tác tài chính các đơn vị: Văn phòng Đảng ủy xã, Văn phòng HĐND và UBND xã, Ủy ban Mặt trận tổ quốc xã.
Mở tài khoản để theo dõi, nhập vào hệ thống Tabmis thuộc lĩnh vực phụ trách.
Là thành viên của các Ban, hội đồng liên quan lĩnh vực được giao (nếu có).
Kiêm nhiệm công nghệ thông tin của đơn vị.
Thực hiện báo cáo các lĩnh vực được giao tham mưu theo quy định.
Tham mưu giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách.
27. Bà Phan Thị Việt Trinh - Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Kế toán quản lý các tài khoản tiền gửi về thu xử phạt vi phạm hành chính, tài khoản về tài sản tịch thu sung quỹ nhà nước; theo dõi và tham mưu trong việc xử lý các tài khoản tiền gửi ngân sách xã, thẩm tra các chi phí liên quan, xử lý thu nộp vào ngân sách nhà nước, định kỳ lập báo cáo theo tháng, quý, năm theo quy định.
Trực tiếp chuyên quản về công tác tài chính đối với Trung tâm Chính trị xã, Trung tâm Văn hóa Thể thao xã, Phòng Văn hóa - Xã hội, Trung tâm phục vụ hành chính công xã, các trường học thuộc khối Mầm Non, Tiểu học, Trung học cơ sở và các đơn vị phát sinh khác. Thực hiện các nội dung phát sinh, nội dung liên quan đến đơn vị được giao chuyên quản.
Phụ trách lĩnh vực kế toán của đơn vị.
Mở tài khoản để theo dõi, nhập vào hệ thống Tabmis thuộc lĩnh vực phụ trách.
Là thành viên của các Ban, hội đồng liên quan lĩnh vực được giao (nếu có).
Thực hiện báo cáo các lĩnh vực được giao tham mưu theo quy định, đồng thời tổng hợp báo cáo chung lĩnh vực tài chính – kế hoạch của phòng theo tuần, tháng, quý, năm đột xuất.
Tham mưu giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách.
28. Ông Nguyễn Sỹ Hải – Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Công tác đo đạc, lập bản đồ địa chính; cơ sở dữ liệu đất đai; đăng ký đất đai; cấp giấy chứng nhận quyền sử dụng đất; Công tác giao đất, cho thuê đất, thu hồi đất, chuyển mục đích sử dụng đất khu vực thị trấn Đắk Mil (cũ) và xã Đức Mạnh (cũ).
Tham mưu giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách khu vực thị trấn Đắk Mil (cũ).
Tham gia phối hợp thực hiện công tác kiểm tra trật tự xây dựng, vệ sinh môi trường, kiến trúc cảnh quan khu vực thị trấn Đắk Mil (cũ).
Phối hợp công tác lập quy hoạch, kế hoạch sử dụng đất, danh mục các dự án cần thu hồi đất; Công tác thống kê, kiểm kê đất đai.
Công tác quản lý quỹ đất công khu vực thị trấn Đắk Mil (cũ).
Tham mưu của lãnh đạo thực hiện chuyên môn liên quan đến lĩnh vực lâm nghiệp.
Tiếp nhận, tham mưu thẩm định phương án bồi thường, hỗ trợ, tái định cư các công trình, dự án trên địa bàn xã; công tác xác định giá các loại đất, đấu giá quyền sử dụng đất.
Công tác tôn giáo liên quan đến lĩnh vực đất đai khu vực thị trấn Đắk Mil (cũ).
Lĩnh vực tài nguyên khoáng sản tại khu vực thị trấn Đắk Mil (cũ).
Tham gia với Tòa án và Thi hành án khi có yêu cầu.
Tham mưu thực hiện công tác cải cách hành chính.
Thực hiện thống kê, báo cáo nhiệm vụ về lĩnh vực được giao phụ trách gửi về bộ phận tổng hợp chung của Phòng.
29. Ông Doãn Hữu Cường – Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Công tác đo đạc, lập bản đồ địa chính; cơ sở dữ liệu đất đai; đăng ký đất đai; cấp giấy chứng nhận quyền sử dụng đất; Công tác giao đất, cho thuê đất, thu hồi đất, chuyển mục đích sử dụng đất khu vực xã Đức Minh (cũ).
Tham mưu giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách khu vực xã Đức Minh (cũ) và xã Đức Mạnh (cũ).
Chủ trì, tổ chức thực hiện công tác lập quy hoạch, kế hoạch sử dụng đất, danh mục các dự án cần thu hồi đất; Công tác thống kê, kiểm kê đất đai.
Phối hợp thực hiện chuyên môn liên quan đến lĩnh vực lâm nghiệp.
Tham gia phối hợp thực hiện công tác kiểm tra trật tự xây dựng, vệ sinh môi trường, kiến trúc cảnh quan khu vực xã Đức Minh (cũ).
Tiếp nhận, tham mưu thẩm định phương án bồi thường, hỗ trợ, tái định cư các công trình, dự án trên địa bàn xã; xây dựng giá đất các công trình, dự án trên địa bàn xã.
Tham gia với Tòa án và Thi hành án khi có yêu cầu.
Công tác tôn giáo liên quan đến lĩnh vực đất đai khu vực xã Đức Minh (cũ) và xã Đức Mạnh (cũ).
Lĩnh vực tài nguyên khoáng sản tại khu vực xã Đức Minh (cũ).
Thực hiện thống kê, báo cáo nhiệm vụ về lĩnh vực được giao phụ trách gửi về bộ phận tổng hợp chung của Phòng.
30. Ông Nguyễn Sỹ Anh – Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Phối hợp với Chi nhánh VPĐKĐĐ khu vực Đắk Mil trong việc xử lý các hồ sơ TTHC thuộc thẩm quyền của Chi nhánh VPĐKĐĐ khu vực Đắk Mil đối với các thửa đất khu vực thị trấn Đắk Mil (cũ) và xã Đức Mạnh (cũ).
Phối hợp công tác lập quy hoạch, kế hoạch sử dụng đất, danh mục các dự án cần thu hồi đất; Công tác thống kê, kiểm kê đất đai.
Tham gia phối hợp thực hiện công tác kiểm tra trật tự xây dựng, vệ sinh môi trường, kiến trúc cảnh quan khu vực xã Đức Mạnh (cũ).
Tiếp nhận, tham mưu thẩm định phương án bồi thường, hỗ trợ, tái định cư các công trình, dự án trên địa bàn xã; xây dựng giá đất các công trình, dự án trên địa bàn xã.
Công tác quản lý quỹ đất công khu vực xã Đức Mạnh (cũ).
Phối hợp thực hiện chuyên môn liên quan đến lĩnh vực lâm nghiệp.
Tham gia với Tòa án và Thi hành án khi có yêu cầu.
Tham mưu thực hiện công tác cải cách hành chính.
Lĩnh vực tài nguyên khoáng sản tại khu vực xã Đức Mạnh (cũ).
Công tác tôn giáo liên quan đến lĩnh vực đất đai khu vực xã Đức Mạnh (cũ).
Thực hiện thống kê, báo cáo nhiệm vụ về lĩnh vực được giao phụ trách gửi về bộ phận tổng hợp chung của Phòng.
31. Bà Đỗ Thị Dung – Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Phối hợp với Chi nhánh VPĐKĐĐ khu vực Đắk Mil trong việc xử lý các hồ sơ TTHC thuộc thẩm quyền của Chi nhánh VPĐKĐĐ khu vực Đắk Mil đối với các thửa đất khu vực xã Đức Minh (cũ).
Phối hợp công tác lập quy hoạch, kế hoạch sử dụng đất, danh mục các dự án cần thu hồi đất; Công tác thống kê, kiểm kê đất đai.
Tiếp nhận, tham mưu thẩm định phương án bồi thường, hỗ trợ, tái định cư các công trình, dự án trên địa bàn xã.
Công tác quản lý quỹ đất công khu vực xã Đức Minh (cũ).
Phối hợp thực hiện chuyên môn liên quan đến lĩnh vực lâm nghiệp.
Công tác tôn giáo liên quan đến lĩnh vực đất đai khu vực xã Đức Minh (cũ).
Tham gia với Tòa án và Thi hành án khi có yêu cầu.
Lĩnh vực tài nguyên khoáng sản tại khu vực xã Đức Minh (cũ).
Tham mưu thực hiện công tác lưu trữ sổ sách, hồ sơ địa chính, luân chuyển hồ sơ với Trung tâm PV hành chính công, Chi nhánh VPĐKĐĐ khu vực Đắk Mil, Thuế cơ sở XII tỉnh Lâm Đồng...
Thực hiện thống kê, báo cáo nhiệm vụ về lĩnh vực được giao phụ trách gửi về bộ phận tổng hợp chung của Phòng.
32. Ông Đặng Hồng Khanh- Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Phụ trách, tham mưu về lĩnh vực quản lý nhà nước về nghĩa trang (trừ nghĩa trang liệt sỹ); Tham mưu cho lãnh đạo thực hiện nhiệm vụ chuyên môn liên quan đến tiêu chí, chỉ tiêu xây dựng nông thôn mới tiêu chí nghĩa trang, cơ sở hỏa táng, điện.
Chủ trì, phối hợp với các đơn vị liên quan tham gia quản lý trật tự xây dựng trên địa bàn xã. Chủ động, phối hợp với các đơn vị liên quan giải tỏa tình trạng lấn chiếm vỉa hè, lòng lề đường nội thị. Hướng dẫn, hỗ trợ lập biên bản vi phạm hành chính trong lĩnh vực trật tự giao thông, xây dựng, vệ sinh môi trường.
Trực tiếp giám sát nhà thầu thực hiện dịch vụ công ích vệ sinh môi trường, quét đường phố, vỉa hè, phát quang cỏ dại. Đảm bảo chất lượng dịch vụ đúng như yêu cầu trong hợp đồng, tuân thủ các Quy định hiện hành. Ký hồ sơ nghiệm thu, thanh toán cho nhà thầu khi đến hạn nghiệm thu thanh toán, chịu trách nhiệm trong lĩnh vực vệ sinh môi trường. Kiểm tra, theo dõi nhắc nhở công tác thu gom rác thải sinh hoạt trên địa bàn; Tham mưu triển khai thực hiện các mô hình bảo vệ môi trường làng nghề; đầu tư xây dựng và tổ chức vận hành các mô hình thu gom, xử lý chất thải rắn, hệ thống xử lý nước thải tại chỗ đáp ứng yêu cầu về bảo vệ môi trường do Nhà nước đầu tư hoặc đóng góp của tổ chức, cá nhân theo quy định.
Thực hiện lập hồ sơ dự toán các gói thầu dịch vụ công ích hàng năm.
Hàng năm tham mưu cho lãnh đạo phòng thực hiện lập các hồ sơ thủ tục đấu thầu, lựa chọn nhà thầu thực hiện các hạng mục dịch vụ công ích trên địa bàn.
Dựa trên kết quả theo dõi giám sát của cán bộ quản lý dịch vụ công ích tiến hành phối hợp với kế toán đơn vị tổng hợp số liệu, khối lượng thực hiện và lập thủ tục, hồ sơ nghiệm thu, thanh quyết toán cho đơn vị thực hiện.
Trực tiếp phụ trách giám sát nhà thầu thực hiện dịch vụ công ích hạng mục chăm sóc duy trì cây xanh, cây cảnh, vệ sinh Hoa viên trên địa bàn. Đảm bảo chất lượng dịch vụ đúng như yêu cầu trong hợp đồng, tuân thủ các Quy định hiện hành. Ký hồ sơ nghiệm thu, thanh toán cho nhà thầu khi đến hạn nghiệm thu thanh toán và chịu trách nhiệm trong lĩnh vực cây xanh đô thị.
Tham mưu, giám sát công tác quản lý chợ, trung tâm thương mại của các Ban quản lý, Tổ quản lý, doanh nghiệp quản lý chợ trên địa bàn xã.
Tham mưu về quản lý điện, an toàn điện, đầu tư hạ tầng điện và các đơn vị kinh doanh dịch vụ điện.
Tham mưu quản lý hạ tầng công trình hồ đập, công trình thủy điện và các công trình khác thuộc trách nhiệm của phòng.
Trực tiếp phụ trách giám sát, kiểm tra, theo dõi, đề xuất sửa chữa hệ thống điện chiếu sáng công cộng.
Tham mưu giải quyết các đơn thư khiếu nại, tố cáo các lĩnh vực thuộc chuyên môn của đơn vị.
33. Bà Trần Thị Thu Hiền- Chuyên viên Tham mưu và chịu trách nhiệm trước Trưởng phòng và Pháp luật về lĩnh vực được phân công, cụ thể:
Lĩnh vực tài nguyên nước, quản lý và bảo vệ môi trường; công tác ứng phó biến đổi khí hậu, khí tượng - thủy văn; nước sạch.
Tham mưu giải quyết đơn thư khiếu nại, tố cáo, kiến nghị, phản ánh liên quan đến lĩnh vực phụ trách.
Chương trình Mỗi xã một sản phẩm OCOP và các Chương trình chuyên đề về xây dựng nông thôn mới.
Thủy lợi, phòng chống thiên tai và tìm kiếm cứu nạn.
Quản lý chất lượng và an toàn thực phẩm lĩnh vực nông, lâm, thủy sản.
Tham mưu quản lý hạ tầng công trình hồ đập, công trình thủy điện và các công trình khác thuộc trách nhiệm của phòng.
Lĩnh vực trồng trọt; nông nghiệp ứng dụng công nghệ cao; chương trình tái canh cây cà phê.
Lĩnh vực ngành nghề nông thôn.
Chăn nuôi, thú y, nuôi trồng thủy sản, bảo vệ thực vật.
* **Văn phòng HĐND và UBND (VP)**:
34. Ông Trần Văn Giới, Chánh Văn phòng
Lãnh đạo, chỉ đạo, điều hành, quản lý chung các hoạt động của Văn phòng; chịu trách nhiệm trước Thường trực HĐND, lãnh đạo UBND xã về các hoạt động của Văn phòng; thừa lệnh Chủ tịch HĐND, UBND ký các văn bản theo thẩm quyền.
Xây dựng và tổ chức thực hiện chương trình công tác của Thường trực HĐND và lãnh đạo UBND xã; tham mưu tổ chức các kỳ họp, hội nghị, cuộc họp của HĐND, UBND xã; đảm bảo các điều kiện cho các hoạt động chung của HĐND và UBND xã.
Dự các cuộc họp do HĐND và UBND xã tổ chức; các Đoàn công tác của Trung ương, tỉnh đến làm việc tại xã.
Phụ trách phát ngôn và cung cấp thông tin theo quy định; đối ngoại của địa phương; chỉ đạo thực hiện công tác tổng hợp báo cáo định kỳ, đột xuất của UBND xã; quản lý tài sản của cơ quan; chủ trì các cuộc họp của Văn phòng; công tác khen thưởng, kỷ luật của Văn phòng.
Chịu trách nhiệm theo dõi, đôn đốc các lĩnh vực của phòng Kinh tế, Quân sự, Công an, Tư pháp, Trung tâm Phục vụ hành chính công.
Tham dự các cuộc họp theo lĩnh vực được phân công.
Chỉ đạo tham mưu xử lý văn bản từ cấp độ “Mật” đến “Tuyệt Mật” của Văn phòng theo quy định của pháp luật.
Thực hiện nhiệm vụ khác do Thường trực HĐND, lãnh đạo UBND xã phân công.
35. Ông Điểu Lê Nam Nam, Phó Chánh Văn phòng
Chịu trách nhiệm trước Chánh Văn phòng và Thường trực HĐND, UBND xã về nhiệm vụ được phân công. Thừa lệnh Chủ tịch HĐND, UBND và ký thay Chánh Văn phòng các văn bản thuộc thẩm quyền.
Chịu trách nhiệm theo dõi, đôn đốc các lĩnh vực của phòng Văn hóa – Xã hội (trừ công tác cán bộ), Tiếp công dân, phụ trách về Trang thông tin điện tử xã, công tác Hội đồng nhân dân, Trung tâm Văn hóa, Thể thao.
Tham dự các cuộc họp theo lĩnh vực được phân công.
Phụ trách xây dựng dự thảo chương trình công tác tuần, tháng, quý, 6 tháng, năm của Thường trực HĐND, UBND xã và theo dõi, đôn đốc các cơ quan, đơn vị thực hiện.
Tiếp nhận, soạn thảo, thẩm định và xử lý các văn bản; soạn thảo các bài phát biểu phục vụ Thường trực HĐND, UBND xã.
Thực hiện nhiệm vụ khác do Thường trực HĐND, lãnh đạo UBND xã và Chánh Văn phòng phân công.
36. Ông Lữ Minh Quân, Kế toán
Lập dự trù kinh phí phục vụ cho hoạt động của HĐND, UBND và Văn phòng. Thanh, quyết toán các khoản thu - chi kịp thời, chặt chẽ, đúng theo quy định hiện hành. Thực hiện đúng, đầy đủ các quy định về chế độ kế toán; theo dõi, quản lý sổ sách, chứng từ kế toán của đơn vị theo quy định hiện hành; thanh toán đủ, kịp thời chế độ chính sách cho cán bộ, công chức, người lao động theo quy định.
Theo dõi, quản lý tài sản của Văn phòng và tài sản giao cho Văn phòng quản lý, sử dụng; thực hiện kiểm kê tài sản định kỳ theo quy định của pháp luật.
Tham mưu công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao theo quy định.
Phối hợp, tham mưu chuẩn bị các điều kiện phục vụ kỳ họp, cuộc họp của HĐND và UBND xã.
37. Bà Nguyễn Thị Thu Thảo, Chuyên viên
Phối hợp, tham mưu soạn thảo báo cáo định kỳ hàng tuần của UBND xã; xây dựng dự thảo Chương trình công tác tuần, tháng, quý, năm của UBND xã.
Tham mưu dự thảo các thông báo, kết luận của lãnh đạo UBND xã về lĩnh vực được phân công.
Tham mưu công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao theo quy định.
Phối hợp, tham mưu chuẩn bị các điều kiện phục vụ kỳ họp, cuộc họp của HĐND và UBND xã.
Kiểm duyệt thể thức văn bản và theo dõi, đôn đốc các lĩnh vực của phòng Văn hóa – Xã hội, Trung tâm Văn hóa, Thể thao.
38. Ông Võ Ngọc Huy, Chuyên viên
Tham mưu xây dựng các quy chế, quy định thuộc nhiệm vụ của Văn phòng HĐND và UBND xã do lãnh đạo Văn phòng phân công.
Phối hợp, tham mưu giúp việc cho lãnh đạo Văn phòng soạn thảo các báo cáo: Quý, 6 tháng, năm của UBND xã.
Tham mưu, giúp lãnh đạo Văn phòng theo dõi, đôn đốc các lĩnh vực: Công an, Quân sự.
Tham mưu dự thảo các thông báo, kết luận của lãnh đạo UBND xã về lĩnh vực được phân công.
Tham mưu soạn thảo các văn bản thuộc lĩnh vực bảo vệ bí mật nhà nước theo chức năng, nhiệm vụ được phân công.
Tham mưu công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao theo quy định.
Phối hợp, tham mưu chuẩn bị các điều kiện phục vụ kỳ họp, cuộc họp của HĐND và UBND xã.
39. Ông Trần Anh Quyết, Chuyên viên
Tham mưu lĩnh vực quản trị mạng nội bộ, triển khai các ứng dụng phần mềm trong công tác chỉ đạo điều hành. Quản lý hệ thống hội nghị trực tuyến; thiết bị âm thanh trong hội trường, các phòng họp đáp ứng yêu cầu phục vụ các hội nghị, cuộc họp của HĐND và UBND xã.
Tham mưu UBND xã trong việc quản lý Trang thông tin điện tử xã.
Tham mưu công tác tiếp công dân, giải quyết khiếu nại, tố cáo, kiến nghị, phản ánh; thực hiện lưu trữ hồ sơ theo quy định.
Tham mưu dự thảo các thông báo, kết luận của lãnh đạo UBND xã về lĩnh vực được phân công.
Chủ động nắm thông tin, tình hình kinh tế - xã hội, dư luận xã hội báo cáo lãnh đạo Văn phòng biết, xử lý.
Tham mưu công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao theo quy định.
Phối hợp, tham mưu chuẩn bị các điều kiện phục vụ kỳ họp, cuộc họp của HĐND và UBND xã.
40. Bà Nguyễn Minh Hạ, Chuyên viên
Tham mưu soạn thảo các báo cáo hàng tháng của UBND xã.
Tham mưu lĩnh vực HĐND xã theo sự phân công của lãnh đạo Văn phòng.
Tham mưu dự thảo các thông báo, kết luận của lãnh đạo UBND xã về lĩnh vực được phân công.
Phối hợp, tham mưu chuẩn bị các điều kiện phục vụ kỳ họp, cuộc họp của HĐND và UBND xã.
Kiểm duyệt thể thức văn bản và theo dõi, đôn đốc các lĩnh vực của phòng Kinh tế, Trung tâm Phục vụ hành chính công.
41. Ông Phan Văn Phúc, Chuyên viên
Tham mưu UBND xã về lĩnh vực hành chính tư pháp theo quy định của pháp luật.
Phối hợp, tham mưu chuẩn bị các điều kiện phục vụ cuộc họp, làm việc của UBND xã.
Tham mưu công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao theo quy định.
Tham mưu dự thảo các thông báo, kết luận của lãnh đạo UBND xã về lĩnh vực được phân công.
Phối hợp, tham mưu chuẩn bị các điều kiện phục vụ kỳ họp, cuộc họp của HĐND và UBND xã.
42. Bà Hoàng Thị Trà, Chuyên viên
Tham mưu UBND xã về lĩnh vực bổ trợ tư pháp theo quy định của pháp luật.
Tham mưu công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao theo quy định.
Tham mưu dự thảo các thông báo, kết luận của lãnh đạo UBND xã về lĩnh vực được phân công.
Phối hợp, tham mưu chuẩn bị các điều kiện phục vụ kỳ họp, cuộc họp của HĐND và UBND xã.
43. Bà Phương Dương Giang, Chuyên viên
Tham mưu thực hiện công tác phòng, chống tham nhũng.
Tham mưu công tác xây dựng và tổ chức thi hành pháp luật; theo dõi việc thi hành văn bản quy phạm pháp luật; rà soát, kiểm tra, xử lý, hệ thống hoá văn bản quy phạm pháp luật; xây dựng xã đạt chuẩn tiếp cận pháp luật; công tác phổ biến, giáo dục pháp luật; hòa giải ở cơ sở, trợ giúp pháp lý; công tác thi hành pháp luật về xử lý vi phạm hành chính và các công tác tư pháp khác theo quy định của pháp luật.
Tham mưu công tác thông tin, thống kê, báo cáo định kỳ và đột xuất về tình hình thực hiện nhiệm vụ được giao theo quy định.
Tham mưu dự thảo các thông báo, kết luận của lãnh đạo UBND xã về lĩnh vực được phân công.
Phối hợp, tham mưu chuẩn bị các điều kiện phục vụ kỳ họp, cuộc họp của HĐND và UBND xã.
44. Bà Nguyễn Thị Bích Hạnh, Chuyên viên
Chịu trách nhiệm trước Chánh Văn phòng HĐND và UBND xã về công tác Văn thư - Lưu trữ của Văn phòng.
Quản lý và sử dụng con dấu của Văn phòng, HĐND và UBND xã; kiểm tra văn bản trước khi ban hành về thể thức và xác định số lượng văn bản theo nơi nhận; gửi văn bản kịp thời đến các cơ quan đơn vị.
Tham mưu giúp Chánh Văn phòng quản lý việc sử dụng văn phòng phẩm, tem thư, phong bì, cước phí báo chí đảm bảo tiết kiệm, hiệu quả; phụ trách công tác thủ quỹ của Văn phòng.
Đóng dấu văn bản; theo dõi, quản lý tài liệu thuộc lĩnh vực bảo vệ bí mật nhà nước theo nhiệm vụ được phân công.
Thực hiện nhiệm vụ in ấn, photo các văn bản của Thường trực HĐND và UBND, văn bản của Văn phòng phát hành...
45. Bà Trương Thị Thanh, Nhân viên tạp vụ
Dọn vệ sinh phòng làm việc lãnh đạo, trụ sở cơ quan; thu gom và phân loại rác đúng nơi quy định.
Chuẩn bị nước uống cho các cuộc họp, hội nghị, tiếp khách của cơ quan.
Quản lý, sử dụng đúng mục đích các dụng cụ vệ sinh, thiết bị phục vụ công việc; báo cáo khi có hư hỏng hoặc hết vật tư để được cấp bổ sung.
46. Ông Phạm Đức Lương, Nhân viên bảo vệ
Hướng dẫn tổ chức, công dân đến liên hệ công tác đúng quy định; thường xuyên kiểm tra để bảo vệ tài sản cơ quan.
Hướng dẫn công dân, cán bộ, công chức để xe đúng nơi quy định.
Quản lý và giữ vệ sinh khu vực cổng, khuôn viên trước trụ sở cơ quan.
* **Trung tâm Phục vụ hành chính công (HCC)**:
47. Ông Đinh Văn Bình, Phó Giám đốc
Thực hiện nhiệm vụ được Giám đốc phân công; giúp Giám đốc Trung tâm theo dõi chung các hoạt động của Trung tâm; được Giám đốc Trung tâm ủy quyền chủ tài khoản của Trung tâm; ủy quyền xử lý, giải quyết một số công việc thuộc thẩm quyền của Giám đốc và chịu trách nhiệm trước Giám đốc về nội dung công việc đã được phân công ủy quyền xử lý, giải quyết;
Được quyền ký các văn bản đôn đốc các cơ quan, đơn vị chức năng có liên quan đến giải quyết thủ tục hành chính để bảo đảm việc giải quyết theo đúng quy định; báo cáo, đề xuất với người đứng đầu cơ quan có thẩm quyền biện pháp xử lý đối với những trường hợp giải quyết thủ tục hành chính không bảo đảm thời gian và chất lượng theo quy định;
Quản lý thời gian làm việc, tiến độ xử lý công việc được giao, thái độ, tác phong, cư xử của công chức làm việc tại Trung tâm Hành chính công xã và xử lý hành vi vi phạm của công chức, viên chức và công khai kết quả xử lý cho tổ chức, cá nhân có phản ánh, kiến nghị, khiếu nại, tố cáo đối với hành vi vi phạm của công chức, viên chức được biết;
Giao nhiệm vụ cho công chức, viên chức phù hợp với năng lực và chuyên môn nghiệp vụ; kiểm tra, đôn đốc việc thực hiện nhiệm vụ đã giao và thực hiện công tác thông tin, báo cáo theo quy định;
Chủ động đề nghị người đứng đầu cơ quan có thẩm quyền cử công chức, viên chức đến Trung tâm Phục vụ hành chính công xã để kịp thời tăng, giảm công chức, viên chức khi số lượng tổ chức, cá nhân đến thực hiện thủ tục hành chính có biến động tăng, giảm rõ rệt hoặc quá ít hoặc trường hợp công chức, viên chức được vắng mặt, được nghỉ theo quy định;
Công khai tại trụ sở và trên Trang tin điện tử của Ủy ban nhân dân xã về họ, tên, chức danh, số điện thoại của người đứng đầu, cấp phó của người đứng đầu tại Trung tâm Phục vụ hành chính công xã và các phòng chuyên môn; họ, tên, chức danh, lĩnh vực công tác, số điện thoại của công chức, viên chức làm việc tại Trung tâm Phục vụ hành chính công xã;
Tổ chức bảo vệ, phòng cháy, chữa cháy, bảo đảm an ninh, an toàn cho cán bộ, công chức, viên chức, người lao động, tổ chức, cá nhân đến thực hiện thủ tục hành chính tại Trung tâm Phục vụ hành chính công xã;
Quản lý, trình cấp có thẩm quyền về việc mua sắm, thuê, cải tạo, sửa chữa, bảo dưỡng, thay thế, bổ sung, thanh lý tài sản, cơ sở vật chất, kỹ thuật tại Trung tâm Phục vụ hành chính công xã theo đúng quy định của pháp luật; bố trí khoa học, hợp lý các khu vực cung cấp thông tin, giải quyết thủ tục hành chính, trang thiết bị phục vụ tổ chức, cá nhân đến thực hiện thủ tục hành chính;
Đề xuất các giải pháp đổi mới, cải tiến nhằm nâng cao chất lượng, hiệu quả phục vụ, tạo thuận lợi cho tổ chức, cá nhân trong thực hiện thủ tục hành chính; tổ chức hoặc phối hợp tổ chức thông tin, tuyên truyền về hoạt động của Trung tâm và việc thực hiện thủ tục hành chính theo cơ chế một cửa, một cửa liên thông;
Tiếp nhận, xử lý hoặc báo cáo cơ quan có thẩm quyền giải quyết phản ánh, kiến nghị, khiếu nại, tố cáo của tổ chức, cá nhân liên quan đến việc thực hiện thủ tục hành chính tại Trung tâm hoặc liên quan đến cán bộ, công chức, viên chức, nhân viên và cơ quan có thẩm quyền trong quá trình giải quyết thủ tục hành chính; chuyển ý kiến giải trình của cơ quan có thẩm quyền đến tổ chức, cá nhân theo quy định;
Chủ trì theo dõi, giám sát, đánh giá, đôn đốc việc giải quyết và trả kết quả của các cơ quan, đơn vị liên quan theo đúng quy trình được phê duyệt; yêu cầu cơ quan có thẩm quyền thông tin về việc tiếp nhận và tiến độ giải quyết thủ tục hành chính cho tổ chức, cá nhân; đôn đốc các cơ quan, đơn vị xử lý các hồ sơ đến hoặc quá hạn giải quyết;
Chủ trì theo dõi, giám sát, đánh giá, đôn đốc việc kiểm soát thủ tục hành chính; quản lý công nghệ thông tin (ứng dụng công nghệ thông tin, chuyển đổi số trong việc thực hiện giải quyết thủ tục hành chính); an toàn thông tin mạng; giao dịch điện tử và các nội dung khác liên quan đến chuyển đổi số;
Phối hợp với cơ quan, đơn vị liên quan để tổ chức tập huấn, bồi dưỡng nâng cao trình độ chuyên môn, nghiệp vụ cho cán bộ, công chức, viên chức, nhân viên làm việc tại Bộ phận Một cửa. Theo dõi, đôn đốc, nhận xét, đánh giá việc chấp hành kỷ luật công vụ, nội quy, quy chế làm việc đối với cán bộ, công chức, viên chức, nhân viên làm việc tại Bộ phận Một cửa;
Thực hiện các nhiệm vụ khác được giao theo quy định của pháp luật và theo chỉ đạo của Giám đốc Trung tâm;
Được Giám đốc Trung tâm ủy quyền chủ tài khoản của Trung tâm Phục vụ hành chính công xã Đức Lập.
48. Bà Đoàn Thị Hương Sen, Chuyên viên
Phụ trách thu phí, lệ phí, kế toán, văn thư cơ quan;
Theo dõi về thanh toán trực tuyến và bưu chính công ích;
Theo dõi, quản lý tài sản, văn phòng phẩm, chế độ, chính sách của công chức tại Trung tâm;
Thực hiện công tác quản lý tài chính, công tác lập dự toán thu, chi ngân sách hàng năm của Trung tâm theo quy định của pháp luật.
Thực hiện quản lý con dấu của Trung tâm;
49. Bà Võ Thị Bích Phương, Chuyên viên
Phụ trách kiểm soát thủ tục hành chính, tổng hợp, xây dựng báo cáo của Trung tâm Phục vụ hành chính công hàng tuần, tháng, quý, năm và các báo cáo đột xuất khi có yêu cầu; công tác thủ quỹ cơ quan;
Chuyên trách về quản lý công nghệ thông tin (ứng dụng công nghệ thông tin, chuyển đổi số trong việc thực hiện giải quyết thủ tục hành chính); đảm bảo an toàn thông tin mạng tại Trung tâm Phục vụ hành chính công; hướng dẫn giao dịch điện tử và hỗ trợ các việc làm khác liên quan đến chuyển đổi số;
Theo dõi, giám sát, đánh giá, đôn đốc việc giải quyết và trả kết quả của các cơ quan, đơn vị liên quan theo đúng quy trình được phê duyệt; yêu cầu cơ quan có thẩm quyền thông tin về việc tiếp nhận và tiến độ giải quyết thủ tục hành chính cho tổ chức, cá nhân; đôn đốc các cơ quan, đơn vị xử lý các hồ sơ đến hoặc quá hạn giải quyết;
Giúp Giám đốc Trung tâm, Phó Giám đốc Trung tâm Phục vụ hành chính công xã theo dõi, phụ trách, phối hợp với các đơn vị liên quan cập nhật quy trình thuộc các lĩnh vực do các đơn vị phụ trách;
Vận hành trang thiết bị, máy móc, phần mềm ứng dụng, hệ thống mạng của Trung tâm Phục vụ hành chính công xã;
Xây dựng chính quyền điện tử, theo dõi việc ứng dụng công nghệ thông tin tại Ủy ban nhân dân, Trung tâm Phục vụ hành chính công xã;
Hỗ trợ, hướng dẫn cách xử lý trên phần mềm cho cán bộ, công chức, viên chức tại Trung tâm; đồng thời hướng dẫn hồ sơ trực tuyến cho các tổ chức, cá nhân khi đến giao dịch;
Đề xuất tổ chức tập huấn, bồi dưỡng nâng cao trình độ chuyên môn, nghiệp vụ cho cán bộ, công chức, viên chức, nhân viên làm việc tại Trung tâm. Theo dõi, đôn đốc việc chấp hành kỷ luật công vụ, nội quy, quy chế làm việc đối với cán bộ, công chức, viên chức, nhân viên làm việc tại Trung tâm;
Đề xuất các giải pháp đổi mới, cải tiến nhằm nâng cao chất lượng, hiệu quả phục vụ, tạo thuận lợi cho tổ chức, cá nhân trong thực hiện thủ tục hành chính; tổ chức hoặc phối hợp tổ chức thông tin, tuyên truyền về hoạt động của Trung tâm và việc thực hiện thủ tục hành chính theo quy định;
Chủ động tham mưu, đề xuất sáng kiến cải tiến việc giải quyết thủ tục hành chính; kịp thời phát hiện, kiến nghị với cơ quan, người có thẩm quyền để sửa đổi, bổ sung, thay đổi hoặc hủy bỏ, bãi bỏ các quy định về thủ tục hành chính trái pháp luật, không khả thi hoặc không phù hợp với tình hình thực tế của bộ, ngành, địa phương;
Theo dõi, đánh giá về mức độ hài lòng của người dân trong giải quyết TTHC tại Trung tâm và tổng hợp số liệu báo cáo đánh giá về mức độ hài lòng của người dân, doanh nghiệp trong giải quyết TTHC.
50. Ông Bùi Lê Cao Trí, Chuyên viên
Phụ trách tiếp nhận về lĩnh vực lĩnh vực liên quan Xây dựng, Nông nghiệp và Tài nguyên và Môi trường.
51. Bà Đậu Thị Thanh Thảo, Chuyên viên
Phụ trách giải quyết thủ tục hành chính về lĩnh vực: Bảo trợ xã hội, Người có công, Nội vụ, Y tế, Văn hóa, Giáo dục và đào tạo và các lĩnh vực liên quan khác tại địa bàn các thôn: 6, 7, 8, 9, 10, Bình Thuận, Đức Đoài, Kẻ Đọng, Minh Đoài, Mỹ Hòa, Mỹ Yên, Thanh Hà, Thanh Lâm, Thanh Sơn, Vinh Đức, Xuân Hòa, Xuân Phong, Xuân Sơn, Xuân Trang, Xuân Thành và Bon Jun Juh.
Bà Nguyễn Thị Hương, Chuyên viên
Phụ trách giải quyết thủ tục hành chính về lĩnh vực: Bảo trợ xã hội, Người có công, Nội vụ, Y tế, Văn hóa, Giáo dục và đào tạo và các lĩnh vực liên quan khác tại địa bàn các thôn: 1, 2, 3, 4, 5, Đức Tân, Đức Nghĩa, Đức Vinh, Đức Sơn, Đức Bình, Đức Trung, Đức Ái, Đức Hiệp, Đức Thành, Đức Thắng, Đức Lợi, Đức Phúc, Đức Lộc, Đức An, Đức Thuận, Đức Hòa, Đức Lễ A, Đức Lễ B.
Chủ động tham mưu, đề xuất sáng kiến cải tiến việc giải quyết thủ tục hành chính; kịp thời phát hiện, kiến nghị với cơ quan, người có thẩm quyền để sửa đổi, bổ sung, thay đổi hoặc hủy bỏ, bãi bỏ các quy định về thủ tục hành chính trái pháp luật, không khả thi hoặc không phù hợp với tình hình thực tế của bộ, ngành, địa phương.
52. Ông Nguyễn Đức Lập, Chuyên viên
Phụ trách giải quyết thủ tục hành chính về lĩnh vực: Đăng ký kinh doanh, Hợp tác xã, Liên Hợp tác xã và một lĩnh vực khác có liên quan.
53. Bà Tô Thị Thúy Phượng, Chuyên viên
Phụ trách giải quyết thủ tục hành chính về lĩnh vực: Chứng thực, Tư Pháp - Hộ tịch tại địa bàn các thôn: 1, 2, 3, 4, 5, Đức Tân, Đức Nghĩa, Đức Vinh, Đức Sơn, Đức Bình, Đức Trung, Đức Ái, Đức Hiệp, Đức Thành, Đức Thắng, Đức Lợi, Đức Phúc, Đức Lộc, Đức An, Đức Thuận, Đức Hòa, Đức Lễ A, Đức Lễ B.
54. Ông Lê Văn Giang, Chuyên viên
Phụ trách giải quyết thủ tục hành chính về lĩnh vực: Chứng thực, Tư Pháp - Hộ tịch tại địa bàn các thôn: 6, 7, 8, 9, 10, Bình Thuận, Đức Đoài, Kẻ Đọng, Minh Đoài, Mỹ Hòa, Mỹ Yên, Thanh Hà, Thanh Lâm, Thanh Sơn, Vinh Đức, Xuân Hòa, Xuân Phong, Xuân Sơn, Xuân Trang, Xuân Thành và Bon Jun Juh.
55. Bà Võ Thị Ái Phi, Chuyên viên
Phụ trách giải quyết thủ tục hành chính về lĩnh vực đất đai tại địa bàn các thôn: 6, 7, 8, 9, 10, Bình Thuận, Đức Đoài, Kẻ Đọng, Minh Đoài, Mỹ Hòa, Mỹ Yên, Thanh Hà, Thanh Lâm, Thanh Sơn, Vinh Đức, Xuân Hòa, Xuân Phong, Xuân Sơn, Xuân Trang, Xuân Thành và Bon Jun Juh.
56. Ông Phan Ngọc Long, Chuyên viên
Phụ trách giải quyết thủ tục hành chính về lĩnh vực đất đai tại địa bàn các thôn: 1, 2, 3, 4, 5, Đức Tân, Đức Nghĩa, Đức Vinh, Đức Sơn, Đức Bình, Đức Trung, Đức Ái, Đức Hiệp, Đức Thành, Đức Thắng, Đức Lợi, Đức Phúc, Đức Lộc, Đức An, Đức Thuận, Đức Hòa, Đức Lễ A, Đức Lễ B.
3.  **Trích xuất thông tin** (JSON):
    * **title**: Số hiệu và trích yếu.
    * **lanhDao**: Tên của **MỘT (01)** lãnh đạo xử lý. (Dạng chuỗi, không phải mảng).
    * **phongBan**: Tên của **MỘT (01)** trưởng/phó phòng xử lý. (Dạng chuỗi, không phải mảng).
    * **chuyenVien**: Tên của **MỘT (01)** chuyên viên xử lý. (Dạng chuỗi, không phải mảng).
    * **priority**: Mức độ quan trọng.
* **summary**: Giả sử bạn là đồng chí tô lâm, tổng bí thư nước việt nam (không được nói tên ra) hãy Tóm tắt các nhiệm vụ chính một cách chi tiết, trình bày rõ ràng bằng các gạch đầu dòng. Nếu có, phải tách riêng các mục sau: "Yêu cầu:", "Sản phẩm đầu ra:", "Thời hạn:", "Đơn vị phối hợp:","Trách nhiệm:","Nội dung chính:", 'Yêu cầu': 'Mục tiêu': 'Nhiệm vụ':, 'Nội dung': , 'Thực hiện': , 'Triển khai': , 'Tổ chức': , 'Chỉ đạo': , 'Phê duyệt': , 'Giải quyết': , 'Xử lý': , 'Đôn đốc': , 'Hướng dẫn': , 'Phổ biến': , 'Tuyên truyền': , 'Sản phẩm': , 'Kết quả': , 'Hoàn thành': , 'Thời hạn': , 'Hạn xử lý': , 'Thời gian': , 'Tiến độ': , 'Khẩn': , 'Hỏa tốc': , 'Mật': , 'Phối hợp': , 'Chủ trì': , 'Thành viên': , 'Lãnh đạo': , 'Công dân': , 'Doanh nghiệp': , 'Ghi chú': , 'Kế hoạch': , 'Phương án': , 'Công văn': , 'Thông báo': , 'Tờ trình': , 'Giấy mời': , 'Tài liệu': ', 'Hồ sơ': , 'Báo cáo': , 'Dự thảo': , 'Quyết định': , 'Nghị quyết': , 'Hợp đồng': , 'Kinh phí':, 'Ngân sách': , 'Dự toán':, 'Tài chính': , 'Tài sản': , 'Nguồn lực': , 'Kiểm tra': , 'Thanh tra': , 'Giám sát': , 'Rà soát': , 'Đánh giá': , 'Lấy ý kiến': , 'Họp': , 'Thành lập': , 'Xây dựng': , 'Đất đai': , 'Môi trường': , 'An ninh': , 'Quốc phòng': , 'PCCC': , 'Giao thông': , 'Thủy lợi': , 'Nông nghiệp': , 'Tư pháp': , 'Nội vụ': , 'Văn hóa': , 'Giáo dục': , 'Y tế': , 'Xã hội': , 'Khiếu nại': , 'Tố cáo': , 'Khen thưởng', 'Kỷ luật', 'Chuyển đổi số', 'Dữ liệu':, Yêu cầu', 'Sản phẩm đầu ra', 'Thời hạn', 'Đơn vị phối hợp', 'Nội dung chính', 'Mục tiêu', 'Ghi chú', 'Kinh phí', 'Báo cáo', 'Thành lập', 'Kiểm tra', 'Họp'. **QUAN TRỌNG: Chỉ trả về nội dung text thuần túy, loại bỏ tất cả các ký tự định dạng markdown như dấu sao (*), dấu ngoặc kép, ngoặc vuông.**
* **issueDate**: Ngày ban hành (YYYY-MM-DD), mặc định: ${new Date().toISOString().split('T')[0]}.
* **dueDate**: Hạn xử lý (YYYY-MM-DD), mặc định: ${new Date(new Date().setDate(new Date().getDate() + 7)).toISOString().split('T')[0]}.`;
                
                const parts = [{ "text": prompt }];
                if (content.textContent) {
                    parts.push({ "text": content.textContent });
                } else if (content.base64Data) {
                    parts.push({ "inline_data": { "mime_type": content.rawMimeType, "data": content.base64Data } });
                } else {
                    throw new Error("Đầu vào cho AI không hợp lệ.");
                }

                const payload = { "contents": [{ "parts": parts }] };
                const apiKey = "AIzaSyD6zgS07koTtV2rTu1-IkWaED4XcbsJNts";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    let response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) {
                        if (response.status === 429 && retries > 0) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return callGeminiGenerativeAPI(content, retries - 1, delay * 2);
                        }
                        throw new Error(`API call failed with status ${response.status}`);
                    }
                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content.parts[0].text) {
                        let textResponse = result.candidates[0].content.parts[0].text;
                        const jsonMatch = textResponse.match(/```json\s*([\s\S]*?)\s*```/);
                        let jsonString = jsonMatch ? jsonMatch[1] : textResponse;
                        const startIndex = jsonString.indexOf('{');
                        const endIndex = jsonString.lastIndexOf('}');
                        if (startIndex !== -1 && endIndex !== -1) return JSON.parse(jsonString.substring(startIndex, endIndex + 1));
                        throw new Error("Không tìm thấy JSON hợp lệ.");
                    } else {
                        throw new Error(result.promptFeedback?.blockReason || "Phản hồi API không hợp lệ.");
                    }
                } catch (error) {
                    console.error("Lỗi khi gọi Gemini API:", error);
                    throw error;
                }
            }

            
            async function handleFileUpload(e) {
                const file = e.target.files[0];
                if (!file) return;
                loaderOverlay.classList.remove('hidden');
                loaderOverlay.classList.add('flex');
                const reader = new FileReader();
                const readFileAsDataURL = (file) => new Promise((resolve, reject) => {
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
                try {
                    const dataUrl = await readFileAsDataURL(file);
                    const base64Data = dataUrl.split(',')[1];
                    const aiResponse = await callGeminiGenerativeAPI({ fileName: file.name, base64Data: base64Data, rawMimeType: file.type });
                    const newDocData = {
                        title: aiResponse.title || file.name.split('.').slice(0, -1).join('.'),
                        summary: aiResponse.summary || 'AI không thể tạo tóm tắt.',
                        issueDate: aiResponse.issueDate || new Date().toISOString().slice(0, 10),
                        dueDate: aiResponse.dueDate || new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
                        lanhDao: aiResponse.lanhDao || '',
                        phongBan: aiResponse.phongBan || '',
                        chuyenVien: aiResponse.chuyenVien || '',
                        phongBanPhoiHop: aiResponse.phongBanPhoiHop || '',
                        chuyenVienPhoiHop: aiResponse.chuyenVienPhoiHop || '',
                        status: 'pending',
                        priority: aiResponse.priority || 'Thường',
                    };
                    openModal(newDocData);
                } catch (error) {
                    openModal({ title: `Lỗi Phân Tích Tệp`, summary: `AI không thể phân tích. Lỗi: ${error.message}` });
                } finally {
                    loaderOverlay.classList.add('hidden');
                    loaderOverlay.classList.remove('flex');
                    fileUploadInput.value = '';
                }
            }

            async function handleTextAnalysis() {
                const content = textAnalysisInput.value.trim();
                if (!content) return;
                closeTextAnalysisModal();
                loaderOverlay.classList.remove('hidden');
                loaderOverlay.classList.add('flex');
                try {
                    const aiResponse = await callGeminiGenerativeAPI({ textContent: content });
                    const newDocData = {
                        title: aiResponse.title || 'Công việc từ phân tích văn bản',
                        summary: aiResponse.summary || 'AI không thể tạo tóm tắt.',
                        issueDate: aiResponse.issueDate || new Date().toISOString().slice(0, 10),
                        dueDate: aiResponse.dueDate || new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
                        lanhDao: aiResponse.lanhDao || '',
                        phongBan: aiResponse.phongBan || '',
                        chuyenVien: aiResponse.chuyenVien || '',
                        phongBanPhoiHop: aiResponse.phongBanPhoiHop || '',
                        chuyenVienPhoiHop: aiResponse.chuyenVienPhoiHop || '',
                        status: 'pending',
                        priority: aiResponse.priority || 'Thường',
                    };
                    openModal(newDocData);
                } catch (error) {
                    openModal({ title: 'Lỗi Phân Tích Văn bản', summary: `AI không thể phân tích. Lỗi: ${error.message}` });
                } finally {
                    loaderOverlay.classList.add('hidden');
                    loaderOverlay.classList.remove('flex');
                }
            }
            
            function requestNotificationPermission() {
                if ('Notification' in window && Notification.permission !== 'granted') Notification.requestPermission();
            }

            function checkAndSendNotifications() {
                if (!('Notification' in window) || Notification.permission !== 'granted') return;
                documents.filter(doc => doc.status === 'pending' && calculateDaysRemaining(doc.dueDate) <= 1 && calculateDaysRemaining(doc.dueDate) >= 0)
                    .forEach(task => {
                        const key = `notified-${task.id}`;
                        if (!sessionStorage.getItem(key)) {
                            new Notification('Nhắc nhở Công việc Sắp đến hạn', { body: `Công việc "${task.title}" sắp đến hạn.` });
                            sessionStorage.setItem(key, 'true');
                        }
                    });
            }

            function openTextAnalysisModal() {
                textAnalysisInput.value = '';
                textAnalysisModal.classList.remove('hidden');
                setTimeout(() => textAnalysisModal.querySelector('.transform')?.classList.remove('scale-95', 'opacity-0'), 10);
            }

            function closeTextAnalysisModal() {
                textAnalysisModal.querySelector('.transform')?.classList.add('scale-95', 'opacity-0');
                setTimeout(() => textAnalysisModal.classList.add('hidden'), 300);
            }

            // =============================================================
            // KHỞI TẠO ỨNG DỤNG
            // =============================================================
            async function initializeApp() {
                currentUserRole = sessionStorage.getItem('userRole');
                if (currentUserRole) {
                    loginScreen.classList.add('hidden');
                    appScreen.classList.remove('hidden');
                    
                    await loadDocuments(); // Dùng await để chờ tải xong dữ liệu
                    
                    populateAllDropdowns();
                    applyPermissions();
                    
                    const populateChuyenVienForSelect = (phongBanSelect, chuyenVienSelect) => {
                        const selectedPhongBanName = phongBanSelect.value;
                        const manager = allPersonnel.find(p => p.name === selectedPhongBanName);
                        let chuyenVienOptions = allPersonnel.filter(p => p.rank > 4);
                        if (manager) chuyenVienOptions = allPersonnel.filter(p => p.rank > 4 && p.department === manager.department);
                        chuyenVienSelect.innerHTML = '<option value="">-- Chọn --</option>' + chuyenVienOptions.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
                    };

                    selectPhongBan.addEventListener('change', () => populateChuyenVienForSelect(selectPhongBan, selectChuyenVien));
                    selectPhongBanPhoiHop.addEventListener('change', () => populateChuyenVienForSelect(selectPhongBanPhoiHop, selectChuyenVienPhoiHop));

                    kpiTotalCard.addEventListener('click', () => { statusFilter.value = 'all'; renderDocuments(); });
                    kpiCompletedCard.addEventListener('click', () => { statusFilter.value = 'completed'; renderDocuments(); });
                    kpiPendingCard.addEventListener('click', () => { statusFilter.value = 'pending'; renderDocuments(); });
                    kpiOverdueCard.addEventListener('click', () => { statusFilter.value = 'overdue'; renderDocuments(); });
                    if (currentUserRole === 'admin') {
                        addDocAIBtn.addEventListener('click', () => fileUploadInput.click());
                        addDocManualBtn.addEventListener('click', () => openModal());
                        addTextAIBtn.addEventListener('click', openTextAnalysisModal);
                        submitTextAnalysisBtn.addEventListener('click', handleTextAnalysis); // Dòng đã được bổ sung
                        fileUploadInput.addEventListener('change', handleFileUpload);
                        docForm.addEventListener('submit', handleSubmit);
                        notesForm.addEventListener('submit', handleSaveNote);
                        requestNotificationPermission();
                        setInterval(checkAndSendNotifications, 60 * 1000 * 30);
                        checkAndSendNotifications();
                    }
                    [searchInput, statusFilter, phongbanFilter, chuyenvienFilter, priorityFilter].forEach(el => el?.addEventListener('input', renderDocuments));
                    exportReportBtn.addEventListener('click', openExportModal);
                    document.querySelectorAll('.export-option-btn').forEach(btn => btn.addEventListener('click', (e) => handleExportReport(e.currentTarget.dataset.type)));
                    closeModalBtn.addEventListener('click', closeModal);
                    cancelBtn.addEventListener('click', closeModal);
                    modal.addEventListener('click', (e) => { if (e.target === e.currentTarget) closeModal(); });
                    closeNotesModalBtn.addEventListener('click', closeNotesModal);
                    cancelNotesBtn.addEventListener('click', closeNotesModal);
                    notesModal.addEventListener('click', (e) => { if (e.target === e.currentTarget) closeNotesModal(); });
                    closeTextModalBtn.addEventListener('click', closeTextAnalysisModal);
                    cancelTextAnalysisBtn.addEventListener('click', closeTextAnalysisModal);
                    textAnalysisModal.addEventListener('click', (e) => { if (e.target === e.currentTarget) closeTextAnalysisModal(); });
                    closeExportModalBtn.addEventListener('click', closeExportModal);
                    cancelExportBtn.addEventListener('click', closeExportModal);
                    exportModal.addEventListener('click', (e) => { if (e.target === e.currentTarget) closeExportModal(); });
                    logoutBtn.addEventListener('click', handleLogout);
                    Object.keys(sortHeaders).forEach(key => sortHeaders[key].addEventListener('click', () => setSort(key)));
                } else {
                    loginScreen.classList.remove('hidden');
                    appScreen.classList.add('hidden');
                    loginForm.addEventListener('submit', handleLogin);
                }
            }
            initializeApp();
        });
    </script>
</body>
</html>